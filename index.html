<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­æ–‡å­¸ç¿’è¨˜éŒ„å™¨ - æœ¬åœ°ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- localStorage ç‰ˆæœ¬ï¼šä¸éœ€è¦ Firebase -->
    
    
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6B9D;
            --secondary: #FEC84B;
            --accent: #845EC2;
            --bg-main: #FFF8F3;
            --bg-card: #FFFFFF;
            --text-dark: #2D3748;
            --text-light: #718096;
            --success: #38B2AC;
            --shadow: 0 4px 20px rgba(255, 107, 157, 0.15);
            --blue: #4A90E2;
            --pink: #FF69B4;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #FFF8F3 0%, #FFE8F0 100%);
            color: var(--text-dark);
            min-height: 100vh;
            padding: 20px;
        }
        
        .hidden {
            display: none !important;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            animation: fadeInDown 0.6s ease;
        }

        h1 {
            font-family: 'Fredoka', 'Noto Sans TC', sans-serif;
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 var(--secondary);
        }

        .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        /* å­¸ç¿’è€…åˆ‡æ›å€åŸŸ */
        .learner-switch {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            text-align: center;
            animation: fadeInDown 0.6s ease;
            animation-delay: 0.2s;
            animation-fill-mode: both;
        }

        .learner-switch-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .learner-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .learner-btn {
            background: white;
            border: 3px solid #E2E8F0;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 150px;
            justify-content: center;
        }

        .learner-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .learner-btn.active {
            border-color: transparent;
            color: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .learner-btn.brother {
            border-color: var(--blue);
            color: var(--blue);
        }

        .learner-btn.brother.active {
            background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
        }

        .learner-btn.sister {
            border-color: var(--pink);
            color: var(--pink);
        }

        .learner-btn.sister.active {
            background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%);
        }

        .current-learner {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .current-learner-name {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            animation: fadeInUp 0.6s ease;
            animation-fill-mode: both;
        }

        .card:nth-child(1) {
            animation-delay: 0.3s;
        }

        .card:nth-child(2) {
            animation-delay: 0.4s;
        }

        .card h2 {
            font-family: 'Fredoka', 'Noto Sans TC', sans-serif;
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            font-size: 1.8rem;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            font-size: 1.2rem;
            font-family: 'Noto Sans TC', sans-serif;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans TC', sans-serif;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 157, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .button-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #FFD700 100%);
            color: var(--text-dark);
        }

        .button-success {
            background: linear-gradient(135deg, var(--success) 0%, #38B2AC 100%);
            color: white;
        }

        .button-filter {
            background: white;
            color: var(--text-dark);
            border: 2px solid #E2E8F0;
            padding: 8px 16px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .button-filter:hover {
            border-color: var(--primary);
        }

        .button-filter.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            border-color: transparent;
            transform: scale(1.05);
            font-weight: 700;
        }

        .filter-checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid currentColor;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
        }

        .button-filter.active .filter-checkbox {
            background: white;
            color: var(--primary);
        }

        .filter-count {
            margin-left: auto;
            font-size: 0.75rem;
            padding: 2px 6px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .button-filter.active .filter-count {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .filter-checkbox::before {
            content: '';
            display: none;
        }

        .button-filter.active .filter-checkbox::before {
            content: 'âœ“';
            display: block;
            font-weight: 900;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .learned-chars {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            min-height: 60px;
        }

        .char-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #FFE8F0 0%, #E0F2FE 100%);
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: 500;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            animation: popIn 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        .char-badge:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .char-badge .char-text {
            cursor: pointer;
        }

        .remove-char {
            display: none;
        }

        .char-badge.mastered {
            background: linear-gradient(135deg, #D4F4DD 0%, #E8F5E9 100%);
            border-color: var(--success);
        }

        .mastery-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--success);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .source-tag-small {
            position: absolute;
            top: 2px;
            left: 2px;
            background: rgba(74, 144, 226, 0.15);
            color: #4A90E2;
            padding: 1px 4px;
            border-radius: 4px;
            font-size: 0.55rem;
            font-weight: 600;
            line-height: 1.2;
        }

        .word-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .word-card {
            background: linear-gradient(135deg, #F0F9FF 0%, #FFF1F2 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            animation: fadeInScale 0.4s ease;
            animation-fill-mode: both;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .word-card:hover {
            border-color: var(--secondary);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(254, 200, 75, 0.3);
        }

        .word-card.mastered {
            background: linear-gradient(135deg, #D4F4DD 0%, #E8F5E9 100%);
            border-color: var(--success);
        }

        .word-chinese {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
        }

        .delete-word {
            display: none;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #E0F2FE 0%, #FFF1F2 100%);
            border-radius: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            font-family: 'Fredoka', sans-serif;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 5px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.3s ease;
        }

        .review-mode {
            background: linear-gradient(135deg, #845EC2 0%, #FF6B9D 100%);
            color: white;
            padding: 60px 40px;
            border-radius: 20px;
            text-align: center;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeInScale 0.5s ease;
        }

        .review-character {
            font-size: 10rem;
            font-weight: 700;
            margin: 40px 0;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.3);
            line-height: 1;
            word-break: break-all;
            max-width: 100%;
            overflow-wrap: break-word;
        }

        @media (max-width: 768px) {
            .modal-content {
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .review-mode {
                padding: 30px 20px;
                min-height: auto;
            }
        }

        .review-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .review-progress {
            font-size: 1.2rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .review-hint {
            font-size: 1rem;
            margin-top: 20px;
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å…¥ç•«é¢ -->
    <div id="loginSection" style="display:none" style="display: flex; justify-content: center; align-items: center; min-height: 100vh;">
        <div style="background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(132, 94, 194, 0.2); text-align: center; max-width: 400px;">
            <h1 style="color: #845EC2; margin-bottom: 10px;">ğŸŒˆ ä¸­æ–‡å­¸ç¿’è¨˜éŒ„å™¨</h1>
            <p style="color: #666; margin-bottom: 30px;">æœ¬åœ°å„²å­˜ç‰ˆ - è³‡æ–™å­˜åœ¨ç€è¦½å™¨</p>
            <button onclick="signInWithGoogle()" style="display: flex; align-items: center; justify-content: center; gap: 12px; width: 100%; padding: 12px 24px; background: white; border: 2px solid #ddd; border-radius: 12px; font-size: 1rem; font-weight: 500; cursor: pointer;">
                <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                    <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                    <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                    <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                    <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                </svg>
                ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥
            </button>
            <p style="color: #999; font-size: 0.85rem; margin-top: 20px;">ç™»å…¥å¾Œè³‡æ–™æœƒè‡ªå‹•åŒæ­¥åˆ°é›²ç«¯</p>
        </div>
    </div>
    
    <!-- ä¸»æ‡‰ç”¨ -->
    <div id="appContent">
    <div class="container">
        <!-- ä½¿ç”¨è€…è³‡è¨Š -->
        <div style="text-align: right; padding: 10px 20px; background: white; border-radius: 12px; margin-bottom: 20px;">
            <span style="color: #666; font-size: 0.9rem;">ç™»å…¥ï¼š<strong id="userEmail" style="color: #845EC2;"></strong></span>
            <button onclick="signOut()" style="margin-left: 15px; padding: 6px 15px; background: #f5f5f5; border: none; border-radius: 6px; cursor: pointer;">ç™»å‡º</button>
        </div>
        
        <header>
            <h1>ğŸŒˆ ä¸­æ–‡å­¸ç¿’è¨˜éŒ„å™¨</h1>
            <p class="subtitle">è¨˜éŒ„å­¸æœƒçš„å­—å’Œè© Â· æ™ºèƒ½è¤‡ç¿’ç³»çµ±</p>
        </header>

        <!-- å­¸ç¿’è€…åˆ‡æ›å€åŸŸ -->
        <div class="learner-switch">
            <div class="learner-switch-label">é¸æ“‡å­¸ç¿’è€…</div>
            <div class="learner-buttons">
                <button class="learner-btn brother active" onclick="switchLearner('brother')">
                    <span>ğŸ‘¦</span>
                    <span>å“¥å“¥</span>
                </button>
                <button class="learner-btn sister" onclick="switchLearner('sister')">
                    <span>ğŸ‘§</span>
                    <span>å¦¹å¦¹</span>
                </button>
            </div>
            <div class="current-learner">
                ç›®å‰å­¸ç¿’è€…ï¼š<span class="current-learner-name" id="currentLearnerName">å“¥å“¥</span> âœ“
            </div>
        </div>

        <!-- è¤‡ç¿’ç³»çµ±èªªæ˜ -->
        <div class="card" style="margin-bottom: 30px; background: linear-gradient(135deg, #E8F5E9 0%, #FFF9C4 100%);">
            <h3 style="color: var(--accent); margin-bottom: 15px; font-size: 1.2rem; display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 1.5rem;">ğŸ“š</span>
                <span>è¤‡ç¿’ç³»çµ±èªªæ˜</span>
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                <div style="background: white; padding: 12px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="font-size: 1.3rem; font-weight: 700; color: #FF6B9D; margin-bottom: 4px;">Level 0</div>
                    <div style="font-size: 0.85rem; color: var(--text-dark); font-weight: 600;">æ–°å­¸</div>
                    <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 4px;">1å¤©å¾Œè¤‡ç¿’</div>
                </div>
                <div style="background: white; padding: 12px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="font-size: 1.3rem; font-weight: 700; color: #FEC84B; margin-bottom: 4px;">Level 1</div>
                    <div style="font-size: 0.85rem; color: var(--text-dark); font-weight: 600;">èªè­˜</div>
                    <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 4px;">3å¤©å¾Œè¤‡ç¿’</div>
                </div>
                <div style="background: white; padding: 12px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="font-size: 1.3rem; font-weight: 700; color: #4A90E2; margin-bottom: 4px;">Level 2</div>
                    <div style="font-size: 0.85rem; color: var(--text-dark); font-weight: 600;">ç†Ÿæ‚‰</div>
                    <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 4px;">7å¤©å¾Œè¤‡ç¿’</div>
                </div>
                <div style="background: white; padding: 12px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="font-size: 1.3rem; font-weight: 700; color: #38B2AC; margin-bottom: 4px;">Level 3</div>
                    <div style="font-size: 0.85rem; color: var(--text-dark); font-weight: 600;">æŒæ¡</div>
                    <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 4px;">14å¤©å¾Œè¤‡ç¿’</div>
                </div>
                <div style="background: white; padding: 12px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="font-size: 1.3rem; font-weight: 700; color: #845EC2; margin-bottom: 4px;">Level 4</div>
                    <div style="font-size: 0.85rem; color: var(--text-dark); font-weight: 600;">ç²¾é€š</div>
                    <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 4px;">60å¤©å¾Œè¤‡ç¿’</div>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.6); border-radius: 8px; font-size: 0.85rem; color: var(--text-dark);">
                <strong>ğŸ’¡ ä½¿ç”¨æç¤ºï¼š</strong>é»æ“Šå­—/è©å¯æ”¾å¤§æŸ¥çœ‹ä¸¦èª¿æ•´ Levelã€‚ç³»çµ±æœƒæ ¹æ“šè¨˜æ†¶æ›²ç·šè‡ªå‹•å®‰æ’è¤‡ç¿’æ™‚é–“ã€‚
            </div>
        </div>

        <div class="main-grid">
            <!-- å·¦å´ï¼šå­¸ç¿’çš„å­— -->
            <div class="card">
                <h2><span class="icon">ğŸ“</span> å­¸æœƒçš„å­—</h2>
                
                <div class="input-group">
                    <label for="charInput">è¼¸å…¥å­¸æœƒçš„ä¸­æ–‡å­—</label>
                    <input type="text" id="charInput" placeholder="ä¾‹å¦‚ï¼šå¤© åœ° äºº">
                </div>

                <div class="button-group">
                    <button onclick="addCharacter()">â• åŠ å…¥</button>
                    <button class="button-secondary" onclick="showBulkInput()">ğŸ“‹ æ‰¹é‡è¼¸å…¥</button>
                    <button class="button-success" onclick="startCharReview()">ğŸ”„ è¤‡ç¿’å­—</button>
                    <button class="button-success sister-only" onclick="startSimilarCharQuiz()" style="display: none; background: linear-gradient(135deg, #FFA07A 0%, #FF6B9D 100%);">ğŸ¯ è¾¨è­˜ç›¸è¿‘å­—</button>
                </div>

                <div class="button-group" style="margin-top: 10px;">
                    <button class="button-secondary" onclick="exportData()">ğŸ“¤ åŒ¯å‡ºè³‡æ–™</button>
                    <button class="button-secondary" onclick="triggerImport()">ğŸ“¥ åŒ¯å…¥è³‡æ–™</button>
                    <button class="button-secondary" onclick="viewHistory()">ğŸ“œ æŸ¥çœ‹ç´€éŒ„</button>
                    <button class="button-secondary sister-only" onclick="manageSimilarChars()" style="display: none; background: linear-gradient(135deg, #4A90E2 0%, #9B59B6 100%); color: white;">âš™ï¸ ç®¡ç†ç›¸è¿‘å­—</button>
                    <button class="button-secondary" onclick="resetCurrentLearner()" style="background: linear-gradient(135deg, #FF6B9D 0%, #FEC84B 100%); color: white;">ğŸ”„ é‡ç½®é è¨­</button>
                    <input type="file" id="importFile" accept="application/json" style="display: none;" onchange="importData(event)">
                </div>

                <div class="input-group" style="margin-top: 15px;">
                    <label>ç¯©é¸é¡¯ç¤º</label>
                    <div class="button-group">
                        <button class="button-filter active" onclick="filterChars('all', this)">
                            <span class="filter-checkbox"></span>
                            <span>å…¨éƒ¨</span>
                        </button>
                        <button class="button-filter" onclick="filterChars(0, this)">
                            <span class="filter-checkbox"></span>
                            <span>æ–°å­¸</span>
                        </button>
                        <button class="button-filter" onclick="filterChars(1, this)">
                            <span class="filter-checkbox"></span>
                            <span>èªè­˜</span>
                        </button>
                        <button class="button-filter" onclick="filterChars(2, this)">
                            <span class="filter-checkbox"></span>
                            <span>ç†Ÿæ‚‰</span>
                        </button>
                        <button class="button-filter" onclick="filterChars(3, this)">
                            <span class="filter-checkbox"></span>
                            <span>æŒæ¡</span>
                        </button>
                        <button class="button-filter" onclick="filterChars(4, this)">
                            <span class="filter-checkbox"></span>
                            <span>ç²¾é€š</span>
                        </button>
                    </div>
                </div>

                <div class="input-group" style="margin-top: 10px;" id="semesterFilterChar">
                    <label>ä¾å­¸æœŸç¯©é¸</label>
                    <div class="button-group">
                        <button class="button-filter active" onclick="filterCharsBySemester('all', this)">
                            <span class="filter-checkbox"></span>
                            <span>å…¨éƒ¨</span>
                            <span class="filter-count" id="semCharCount-all"></span>
                        </button>
                        <button class="button-filter" onclick="filterCharsBySemester('1ä¸Š', this)">
                            <span class="filter-checkbox"></span>
                            <span>ä¸€ä¸Š</span>
                            <span class="filter-count" id="semCharCount-1ä¸Š"></span>
                        </button>
                        <button class="button-filter" onclick="filterCharsBySemester('1ä¸‹', this)">
                            <span class="filter-checkbox"></span>
                            <span>ä¸€ä¸‹</span>
                            <span class="filter-count" id="semCharCount-1ä¸‹"></span>
                        </button>
                        <button class="button-filter" onclick="filterCharsBySemester('2ä¸Š', this)">
                            <span class="filter-checkbox"></span>
                            <span>äºŒä¸Š</span>
                            <span class="filter-count" id="semCharCount-2ä¸Š"></span>
                        </button>
                        <button class="button-filter" onclick="filterCharsBySemester('2ä¸‹', this)">
                            <span class="filter-checkbox"></span>
                            <span>äºŒä¸‹</span>
                            <span class="filter-count" id="semCharCount-2ä¸‹"></span>
                        </button>
                    </div>
                </div>

                <div class="input-group" style="margin-top: 10px;" id="lessonFilterChar">
                    <label>ä¾èª²åˆ¥ç¯©é¸</label>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <select id="lessonSelect" style="flex: 1; padding: 8px; border: 2px solid rgba(132, 94, 194, 0.3); border-radius: 8px; background: white; font-size: 0.9rem; cursor: pointer;">
                            <option value="all">å…¨éƒ¨èª²åˆ¥</option>
                        </select>
                        <button onclick="applyLessonFilter('char')" style="padding: 8px 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                            å¥—ç”¨
                        </button>
                        <button onclick="clearLessonFilter('char')" style="padding: 8px 15px; background: rgba(132, 94, 194, 0.2); color: #667eea; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                            æ¸…é™¤
                        </button>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalChars">0</div>
                        <div class="stat-label">å·²å­¸çš„å­—</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="reviewChars">0</div>
                        <div class="stat-label">éœ€è¤‡ç¿’</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="masteredChars">0</div>
                        <div class="stat-label">å·²æŒæ¡</div>
                    </div>
                </div>

                <div class="learned-chars" id="learnedChars">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“š</div>
                        <p>é‚„æ²’æœ‰è¨˜éŒ„ï¼Œé–‹å§‹æ·»åŠ å§ï¼</p>
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šå­¸æœƒçš„è© -->
            <div class="card">
                <h2><span class="icon">âœ¨</span> å­¸æœƒçš„è©</h2>
                
                <div class="input-group">
                    <label for="wordInput">æ‰‹å‹•è¼¸å…¥è©å½™ï¼ˆæœƒè‡ªå‹•è¨˜éŒ„çµ„æˆçš„å­—ï¼‰</label>
                    <input type="text" id="wordInput" placeholder="ä¾‹å¦‚ï¼šå¤©å¤© æ—¥æ—¥ å¤§äºº">
                </div>

                <div class="button-group">
                    <button onclick="addWord()">â• åŠ å…¥è©å½™</button>
                    <button class="button-success" onclick="startWordReview()">ğŸ”„ è¤‡ç¿’è©</button>
                </div>

                <div class="input-group" style="margin-top: 15px;">
                    <label>ç¯©é¸é¡¯ç¤º</label>
                    <div class="button-group">
                        <button class="button-filter active" onclick="filterWords('all', this)">
                            <span class="filter-checkbox"></span>
                            <span>å…¨éƒ¨</span>
                        </button>
                        <button class="button-filter" onclick="filterWords(0, this)">
                            <span class="filter-checkbox"></span>
                            <span>æ–°å­¸</span>
                        </button>
                        <button class="button-filter" onclick="filterWords(1, this)">
                            <span class="filter-checkbox"></span>
                            <span>èªè­˜</span>
                        </button>
                        <button class="button-filter" onclick="filterWords(2, this)">
                            <span class="filter-checkbox"></span>
                            <span>ç†Ÿæ‚‰</span>
                        </button>
                        <button class="button-filter" onclick="filterWords(3, this)">
                            <span class="filter-checkbox"></span>
                            <span>æŒæ¡</span>
                        </button>
                        <button class="button-filter" onclick="filterWords(4, this)">
                            <span class="filter-checkbox"></span>
                            <span>ç²¾é€š</span>
                        </button>
                    </div>
                </div>

                <div class="input-group" style="margin-top: 10px;" id="semesterFilterWord">
                    <label>ä¾å­¸æœŸç¯©é¸</label>
                    <div class="button-group">
                        <button class="button-filter active" onclick="filterWordsBySemester('all', this)">
                            <span class="filter-checkbox"></span>
                            <span>å…¨éƒ¨</span>
                            <span class="filter-count" id="semWordCount-all"></span>
                        </button>
                        <button class="button-filter" onclick="filterWordsBySemester('1ä¸Š', this)">
                            <span class="filter-checkbox"></span>
                            <span>ä¸€ä¸Š</span>
                            <span class="filter-count" id="semWordCount-1ä¸Š"></span>
                        </button>
                        <button class="button-filter" onclick="filterWordsBySemester('1ä¸‹', this)">
                            <span class="filter-checkbox"></span>
                            <span>ä¸€ä¸‹</span>
                            <span class="filter-count" id="semWordCount-1ä¸‹"></span>
                        </button>
                        <button class="button-filter" onclick="filterWordsBySemester('2ä¸Š', this)">
                            <span class="filter-checkbox"></span>
                            <span>äºŒä¸Š</span>
                            <span class="filter-count" id="semWordCount-2ä¸Š"></span>
                        </button>
                        <button class="button-filter" onclick="filterWordsBySemester('2ä¸‹', this)">
                            <span class="filter-checkbox"></span>
                            <span>äºŒä¸‹</span>
                            <span class="filter-count" id="semWordCount-2ä¸‹"></span>
                        </button>
                    </div>
                </div>

                <div class="input-group" style="margin-top: 10px;" id="lessonFilterWord">
                    <label>ä¾èª²åˆ¥ç¯©é¸</label>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <select id="lessonSelectWord" style="flex: 1; padding: 8px; border: 2px solid rgba(132, 94, 194, 0.3); border-radius: 8px; background: white; font-size: 0.9rem; cursor: pointer;">
                            <option value="all">å…¨éƒ¨èª²åˆ¥</option>
                        </select>
                        <button onclick="applyLessonFilter('word')" style="padding: 8px 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                            å¥—ç”¨
                        </button>
                        <button onclick="clearLessonFilter('word')" style="padding: 8px 15px; background: rgba(132, 94, 194, 0.2); color: #667eea; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                            æ¸…é™¤
                        </button>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalWords">0</div>
                        <div class="stat-label">å·²å­¸çš„è©</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="reviewWords">0</div>
                        <div class="stat-label">éœ€è¤‡ç¿’</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="masteredWords">0</div>
                        <div class="stat-label">å·²æŒæ¡</div>
                    </div>
                </div>

                <div class="word-grid" id="wordGrid">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸŒŸ</div>
                        <p>è¼¸å…¥è©å½™é–‹å§‹è¨˜éŒ„</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡è¼¸å…¥æ¨¡æ…‹æ¡† -->
    <div class="modal" id="bulkModal">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;">æ‰¹é‡è¼¸å…¥ä¸­æ–‡å­—</h2>
            <div class="input-group">
                <label for="bulkInput">å¯ä»¥ä¸€æ¬¡è¼¸å…¥å¤šå€‹å­—ï¼Œç”¨ç©ºæ ¼æˆ–æ›è¡Œåˆ†éš”</label>
                <textarea id="bulkInput" placeholder="ä¾‹å¦‚ï¼šå¤© åœ° äºº æ—¥ æœˆ&#10;æˆ–ï¼šå¤©åœ°äººæ—¥æœˆ"></textarea>
            </div>
            <div class="button-group">
                <button onclick="addBulkCharacters()">ç¢ºèªæ·»åŠ </button>
                <button class="button-secondary" onclick="closeBulkInput()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- è¤‡ç¿’æ¨¡æ…‹æ¡† -->
    <div class="modal" id="reviewModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="review-mode">
                <div class="review-progress" id="reviewProgress">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
                <div class="review-character" id="reviewCharacter">é–‹å§‹</div>
                <div class="review-hint" id="reviewHint">èªè­˜é€™å€‹å­—/è©å—ï¼Ÿ</div>
                <div class="review-buttons">
                    <button class="button-success" onclick="markCorrect()">âœ“ èªè­˜</button>
                    <button class="button-secondary" onclick="markIncorrect()">âœ— ä¸èªè­˜</button>
                    <button onclick="endReview()">çµæŸè¤‡ç¿’</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ”¾å¤§é¡¯ç¤ºæ¨¡æ…‹æ¡† -->
    <div class="modal" id="enlargeModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="review-mode">
                <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 10px;">
                    <div class="review-progress" id="enlargeLevel">Level 0</div>
                    <div id="enlargeSource" 
                         onclick="editSource()" 
                         style="font-size: 0.85rem; color: rgba(255,255,255,0.7); padding: 4px 12px; background: rgba(74, 144, 226, 0.2); border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 5px;"
                         title="é»æ“Šä¿®æ”¹ä¾†æº">
                        <span id="enlargeSourceText"></span>
                        <span style="font-size: 0.7rem;">âœï¸</span>
                    </div>
                </div>
                <div class="review-character" id="enlargeCharacter" style="margin: 60px 0;">å­—</div>
                
                <div style="margin: 20px 0;">
                    <p style="font-size: 0.9rem; margin-bottom: 8px;">å­—é«”å¤§å°</p>
                    <input type="range" id="fontSizeSlider" min="3" max="12" value="10" step="0.5" 
                           style="width: 100%; cursor: pointer;" 
                           oninput="adjustFontSize(this.value)">
                </div>
                
                <div style="margin: 20px 0;">
                    <p style="font-size: 1rem; margin-bottom: 10px;">è¨­å®šæŒæ¡ç¨‹åº¦ï¼š</p>
                    <div class="button-group" style="justify-content: center;">
                        <button class="button-filter" style="min-width: 50px;" onclick="setLevel(0)">
                            <span style="display: block; font-weight: 700;">0</span>
                            <span style="display: block; font-size: 0.7rem;">æ–°å­¸</span>
                        </button>
                        <button class="button-filter" style="min-width: 50px;" onclick="setLevel(1)">
                            <span style="display: block; font-weight: 700;">1</span>
                            <span style="display: block; font-size: 0.7rem;">èªè­˜</span>
                        </button>
                        <button class="button-filter" style="min-width: 50px;" onclick="setLevel(2)">
                            <span style="display: block; font-weight: 700;">2</span>
                            <span style="display: block; font-size: 0.7rem;">ç†Ÿæ‚‰</span>
                        </button>
                        <button class="button-filter" style="min-width: 50px;" onclick="setLevel(3)">
                            <span style="display: block; font-weight: 700;">3</span>
                            <span style="display: block; font-size: 0.7rem;">æŒæ¡</span>
                        </button>
                        <button class="button-filter" style="min-width: 50px;" onclick="setLevel(4)">
                            <span style="display: block; font-weight: 700;">4</span>
                            <span style="display: block; font-size: 0.7rem;">ç²¾é€š</span>
                        </button>
                    </div>
                    <p style="font-size: 0.75rem; color: rgba(255,255,255,0.7); margin-top: 10px; text-align: center;">
                        è¤‡ç¿’é–“éš”ï¼š1å¤© â†’ 3å¤© â†’ 7å¤© â†’ 14å¤© â†’ 60å¤©
                    </p>
                </div>
                
                <div class="review-buttons">
                    <button class="button-secondary" onclick="deleteFromEnlarge()">ğŸ—‘ï¸ åˆªé™¤</button>
                    <button onclick="closeEnlarge()">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†ç›¸è¿‘å­—æ¨¡æ…‹æ¡† -->
    <div class="modal" id="manageSimilarModal">
        <div class="modal-content" style="max-width: 600px;">
            <h2 style="margin-bottom: 20px; color: #4A90E2;">âš™ï¸ ç®¡ç†ç›¸è¿‘å­—çµ„</h2>
            
            <div style="background: #f5f7fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h3 style="font-size: 1rem; margin-bottom: 15px; color: #333;">â• æ–°å¢ç›¸è¿‘å­—çµ„</h3>
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                    <input type="text" id="similarChar1" placeholder="ç¬¬ä¸€å€‹å­—" maxlength="1" style="width: 80px; font-size: 1.5rem; text-align: center; padding: 10px; border: 2px solid #4A90E2; border-radius: 8px;">
                    <span style="font-size: 1.2rem; color: #666;">vs</span>
                    <input type="text" id="similarChar2" placeholder="ç¬¬äºŒå€‹å­—" maxlength="1" style="width: 80px; font-size: 1.5rem; text-align: center; padding: 10px; border: 2px solid #4A90E2; border-radius: 8px;">
                    <button onclick="addSimilarPair()" style="padding: 10px 20px; background: linear-gradient(135deg, #4A90E2 0%, #9B59B6 100%); color: white; border: none; border-radius: 8px; cursor: pointer;">æ–°å¢</button>
                </div>
                <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">ğŸ’¡ ä¾‹å¦‚ï¼šæ—¥ vs ç›®ã€äºº vs å…¥</p>
            </div>
            
            <div id="similarPairsList" style="max-height: 300px; overflow-y: auto;">
                <h3 style="font-size: 1rem; margin-bottom: 15px; color: #333;">ğŸ“‹ å·²å»ºç«‹çš„ç›¸è¿‘å­—çµ„</h3>
                <div id="pairsContainer"></div>
            </div>
            
            <div class="button-group" style="margin-top: 20px;">
                <button onclick="closeSimilarManage()">é—œé–‰</button>
            </div>
        </div>
    </div>

    <!-- ç›¸è¿‘å­—æ¸¬é©—æ¨¡æ…‹æ¡† -->
    <div class="modal" id="similarQuizModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="review-mode">
                <div class="review-progress" id="quizProgress">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
                <div style="margin: 40px 0;">
                    <p style="font-size: 1.2rem; color: rgba(255,255,255,0.9); margin-bottom: 20px;" id="quizQuestion">é¸å‡ºæ­£ç¢ºçš„å­—ï¼š</p>
                    <div style="font-size: 4rem; font-weight: bold; margin: 20px 0;" id="quizTarget">ï¼Ÿ</div>
                </div>
                <div class="review-buttons" style="flex-direction: column; gap: 15px;">
                    <button class="button-success" onclick="selectQuizAnswer(0)" id="quizOption1" style="width: 100%; font-size: 2rem; padding: 20px;">é¸é …1</button>
                    <button class="button-success" onclick="selectQuizAnswer(1)" id="quizOption2" style="width: 100%; font-size: 2rem; padding: 20px;">é¸é …2</button>
                </div>
                <div style="margin-top: 20px;">
                    <button class="button-secondary" onclick="endSimilarQuiz()">çµæŸæ¸¬é©—</button>
                </div>
                <div id="quizResult" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none; font-size: 1.2rem;"></div>
            </div>
        </div>
    </div>

    <script>
        // ==================== Firebase åˆå§‹åŒ– ====================
        
        // æœ¬åœ°ç‰ˆæœ¬ä¸éœ€è¦ Firebase
        let currentUser = null;
        
        // ==================== å…¨åŸŸè®Šæ•¸ ====================
        
        // è¨˜æ†¶æ›²ç·šé–“éš”ï¼ˆå¤©æ•¸ï¼‰- 5ç´šåˆ¶
        // Level 0: æ–°å­¸ (1å¤©å¾Œè¤‡ç¿’)
        // Level 1: èªè­˜ (3å¤©å¾Œè¤‡ç¿’)
        // Level 2: ç†Ÿæ‚‰ (7å¤©å¾Œè¤‡ç¿’)
        // Level 3: æŒæ¡ (14å¤©å¾Œè¤‡ç¿’)
        // Level 4: ç²¾é€š (60å¤©å¾Œè¤‡ç¿’)
        const REVIEW_INTERVALS = [1, 3, 7, 14, 60];
        const HISTORY_MAX_SIZE = 1000;
        
        let currentLearner = 'brother'; // 'brother' æˆ– 'sister'
        let learnedCharacters = new Map();
        let learnedWords = new Map();
        let reviewList = [];
        let reviewIndex = 0;
        let reviewType = '';
        let charFilter = new Set(['all']); // æ”¹ç”¨ Set ä¾†æ”¯æ´è¤‡é¸
        let wordFilter = new Set(['all']); // æ”¹ç”¨ Set ä¾†æ”¯æ´è¤‡é¸
        let charSemesterFilter = new Set(['all']); // å­¸æœŸç¯©é¸æ”¹ç‚º Set æ”¯æ´è¤‡é¸
        let wordSemesterFilter = new Set(['all']); // å­¸æœŸç¯©é¸æ”¹ç‚º Set æ”¯æ´è¤‡é¸
        let charLessonFilter = 'all'; // èª²åˆ¥ç¯©é¸
        let wordLessonFilter = 'all'; // èª²åˆ¥ç¯©é¸
        
        // ç›¸è¿‘å­—è¾¨è­˜ç³»çµ±ï¼ˆåªçµ¦å¦¹å¦¹ç”¨ï¼‰
        let similarCharPairs = []; // [{char1: 'æ—¥', char2: 'ç›®'}, ...]
        let quizList = [];
        let quizIndex = 0;
        let currentQuizAnswer = 0; // 0 æˆ– 1

        // ==================== å­¸ç¿’è€…åˆ‡æ›åŠŸèƒ½ ====================
        
        function resetCurrentLearner() {
            const learnerName = currentLearner === 'brother' ? 'å“¥å“¥' : 'å¦¹å¦¹';
            if (!confirm(`ç¢ºå®šè¦é‡ç½®${learnerName}çš„è³‡æ–™å—ï¼Ÿ\n\né€™å°‡æ¸…é™¤æ‰€æœ‰å­—è©å’Œç´€éŒ„ï¼Œä¸¦è¼‰å…¥é è¨­è³‡æ–™ã€‚`)) {
                return;
            }
            
            // æ¸…é™¤ç•¶å‰å­¸ç¿’è€…çš„è³‡æ–™
            localStorage.removeItem(`learner_${currentLearner}_data`);
            localStorage.removeItem(`learner_${currentLearner}_history`);
            
            // é‡æ–°è¼‰å…¥ï¼ˆæœƒè§¸ç™¼é è¨­è³‡æ–™è¼‰å…¥ï¼‰
            loadCurrentLearnerData();
            updateUI();
            
            showNotification(`âœ… å·²é‡ç½®${learnerName}çš„é è¨­è³‡æ–™`);
        }
        
        function switchLearner(learner) {
            // å„²å­˜ç•¶å‰å­¸ç¿’è€…çš„è³‡æ–™
            saveCurrentLearnerData();
            
            // åˆ‡æ›å­¸ç¿’è€…
            currentLearner = learner;
            localStorage.setItem('currentLearner', learner);
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.learner-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.learner-btn.${learner}`).classList.add('active');
            
            // æ›´æ–°é¡¯ç¤ºåç¨±
            const name = learner === 'brother' ? 'å“¥å“¥' : 'å¦¹å¦¹';
            document.getElementById('currentLearnerName').textContent = name;
            
            // è¼‰å…¥æ–°å­¸ç¿’è€…çš„è³‡æ–™
            loadCurrentLearnerData();
            
            // é‡ç½®ç¯©é¸å™¨
            charFilter = new Set(['all']);
            wordFilter = new Set(['all']);
            charSemesterFilter = new Set(['all']);
            wordSemesterFilter = new Set(['all']);
            charLessonFilter = 'all';
            wordLessonFilter = 'all';
            resetFilterButtons();
            
            // æ§åˆ¶å­¸æœŸç¯©é¸å’Œèª²åˆ¥ç¯©é¸çš„é¡¯ç¤ºï¼ˆåªæœ‰å“¥å“¥æ‰é¡¯ç¤ºï¼‰
            const semesterFilterChar = document.getElementById('semesterFilterChar');
            const semesterFilterWord = document.getElementById('semesterFilterWord');
            const lessonFilterChar = document.getElementById('lessonFilterChar');
            const lessonFilterWord = document.getElementById('lessonFilterWord');
            
            // æ§åˆ¶ç›¸è¿‘å­—è¾¨è­˜æŒ‰éˆ•çš„é¡¯ç¤ºï¼ˆåªæœ‰å¦¹å¦¹æ‰é¡¯ç¤ºï¼‰
            const sisterOnlyButtons = document.querySelectorAll('.sister-only');
            
            if (learner === 'brother') {
                semesterFilterChar.style.display = 'block';
                semesterFilterWord.style.display = 'block';
                lessonFilterChar.style.display = 'block';
                lessonFilterWord.style.display = 'block';
                // æ›´æ–°èª²åˆ¥é¸é …å’Œå­¸æœŸçµ±è¨ˆ
                updateLessonOptions();
                updateSemesterCounts();
                // éš±è—å¦¹å¦¹å°ˆå±¬æŒ‰éˆ•
                sisterOnlyButtons.forEach(btn => btn.style.display = 'none');
            } else {
                semesterFilterChar.style.display = 'none';
                semesterFilterWord.style.display = 'none';
                lessonFilterChar.style.display = 'none';
                lessonFilterWord.style.display = 'none';
                // é¡¯ç¤ºå¦¹å¦¹å°ˆå±¬æŒ‰éˆ•
                sisterOnlyButtons.forEach(btn => btn.style.display = 'inline-block');
            }
            
            // æ›´æ–°UI
            updateUI();
            
            showNotification(`å·²åˆ‡æ›åˆ°${name}çš„å­¸ç¿’è¨˜éŒ„`);
        }

        function saveCurrentLearnerData() {
            const data = {
                characters: Object.fromEntries(learnedCharacters),
                words: Object.fromEntries(learnedWords),
                timestamp: new Date().toISOString()
            };
            localStorage.setItem(`learner_${currentLearner}_data`, JSON.stringify(data));
        }

        function loadCurrentLearnerData() {
            const saved = localStorage.getItem(`learner_${currentLearner}_data`);
            
            learnedCharacters.clear();
            learnedWords.clear();
            
            let hasData = false;
            
            if (saved) {
                const data = JSON.parse(saved);
                
                if (data.characters && Object.keys(data.characters).length > 0) {
                    if (Array.isArray(data.characters)) {
                        data.characters.forEach(char => {
                            learnedCharacters.set(char, createNewItem());
                        });
                    } else {
                        learnedCharacters = new Map(Object.entries(data.characters));
                    }
                    hasData = true;
                }
                
                if (data.words && Object.keys(data.words).length > 0) {
                    if (Array.isArray(data.words)) {
                        data.words.forEach(word => {
                            learnedWords.set(word, createNewItem());
                        });
                    } else {
                        learnedWords = new Map(Object.entries(data.words));
                    }
                }
            }
            
            // å¦‚æœ localStorage æ²’æœ‰è³‡æ–™æˆ–è³‡æ–™æ˜¯ç©ºçš„ï¼Œè¼‰å…¥é è¨­è³‡æ–™
            if (!hasData) {
                if (currentLearner === 'sister') {
                    // å¦¹å¦¹çš„é è¨­å­—åº«ï¼ˆ161å€‹å­—ï¼‰
                    const sisterDefaultChars = 'ä¸Šä¸‹ä¸ä¸Ÿä¹³äº®ä½©ä¾†å€‹å„ªå…¬å†°å†·å‰ªå‹•å»å‹å£åƒå‘€å‘†å“ˆå•Šå–å–µå˜´å››åœ’åœŸåœ°å¤šå¤ªå¥³å§¨å­å­©å®›å°‘å°¿å±±å¸«å¸½å¼Ÿå¿ƒå¿«æ„›æˆ‘æ‰‹æ‰“æ¬æ›¸æœ‹æœ¨æ±æœæ¡ƒæ¡Œæ¨‚æ©˜æ­Œæ°´æ³¨æ´—æ½¤æ¿•ç‚’ç…®ç‰™ç‹—çŒ©çŒ´ç©çƒç”Ÿç”·ç•«ç—…ç™½çš®çœ‰çŸ³ç¬‘ç­†ç­·ç±³ç²‰ç´…ç¶ ç¾Šè€è€³è‚‰è‚šèˆè‰²èŠ’èŠ±è‰è‘¡è—è˜‹è›‡è¥¿è®€è±†è±¬è²“è²·èµ·è·³è»Šéé…ªé‹¼éŒ¢é–‹é˜¿é›é›ªé›»é‹é ­é£›é£½é¤…é¤Šé¦¬é«˜é«®é¬†é­šé´¨é¹¿é»ƒé»‘é¼ é¼»èˆ¹é¦™ä¸€ä¸‰äºŒäº”äººå…”å“¥åå¤§å¦¹åª½å°æ˜Ÿæœˆç«ç†Šçˆ¸èœè›‹é†«é–€é£¯';
                    
                    // è¼‰å…¥å­—
                    for (let char of sisterDefaultChars) {
                        learnedCharacters.set(char, createNewItem());
                    }
                    
                    console.log('âœ“ è¼‰å…¥å¦¹å¦¹é è¨­è³‡æ–™:', learnedCharacters.size, 'å€‹å­—');
                } else if (currentLearner === 'brother') {
                // å“¥å“¥çš„ä¸€ä¸Šå­—è©é è¨­è³‡æ–™ï¼ˆ0-6èª²ï¼‰
                const now = Date.now();
                
                const brotherChars = {"ä¸€":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-0"},"äºŒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-0"},"ä¸‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-0"},"å››":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-0"},"äº”":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-0"},"å…­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-0"},"ä¸ƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-0"},"å…«":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-0"},"ä¹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-0"},"å":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-0"},"æ‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"æ‰‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"å·¦":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"å³":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"ä½ ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"ä»–":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"ä¹Ÿ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"ä¸Š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"ä¸‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"é€™":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"æ˜¯":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"èª°":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"çš„":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"æˆ‘":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"åˆ†":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"å¥½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"äº†":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"å•Š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"å¤š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"å€‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"ç§‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"åƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"å’Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"ç©":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"é™ª":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"é«˜":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"å±±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"åˆ°":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"å¤§":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"æµ·":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"æœ‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"å‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"å€‘":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"èµ·":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"å­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"å°":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"èª²":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"å…©":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"äºº":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"æ‹‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"çœ‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"æ‰¾":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"éš»":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"é’":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"è›™":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"é–‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"å¿ƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"æ¯”":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"é–€":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"è£¡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"å¤–":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"æœ‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"ä»€":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"éº¼":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"ä¸":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"åŒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"æ—©":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"æ™š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"ç‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"ä¸»":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"åˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"è·¯":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"é•·":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"ç™½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"èŠ±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"ç´…":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"èµ°":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"åœ¨":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"å‘":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"èªª":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"æœµ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"å¾":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"é ­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"é‚£":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"}};
                
                const brotherWords = {"æ‹æ‰‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"å·¦å³":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"ä¸Šä¸Šä¸‹ä¸‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-1"},"ä¸€å€‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-2"},"ç§‹åƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"é«˜å±±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"å¤§æµ·":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"æˆ‘å€‘":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"å¥½æœ‹å‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"ä¸€èµ·":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-3"},"å€‹å­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"ä¸Šèª²":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"é’è›™":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"é–‹å¿ƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-4"},"é–€å¤–":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"ä»€éº¼":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"ä¸åŒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"æ—©ä¸Š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"æ™šä¸Š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"ç‹å­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"ä¸»äºº":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-5"},"å°è·¯":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"ç™½èŠ±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"ç´…èŠ±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"},"ä¸€é ­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸Š-6"}};
                
                // ä¸€ä¸‹çš„å­—è©è³‡æ–™ï¼ˆç¬¬1-12èª²ï¼‰
                const brotherChars_1down = {"äº‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"äº«":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"äº®":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"ä»Š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"ä»¶":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"ä¼‘":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"ä¼´":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"ä½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"ä½œ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"ä¾†":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"åš":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"åœ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"åƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"å…ˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"å…‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"å…’":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"å…¬":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"å†":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"å‡º":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"åˆ·":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"å‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"åŠ ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"åŒ–":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"å‡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"åŠ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"å¡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"å»":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"å—":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"å£":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"åƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"å§":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"å‘¢":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"å”±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"å•":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"å–œ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"å—":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"å›":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"åœ‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"åœ’":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"åœ°":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"å¤¢":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"å¤©":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"å¤ª":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"å¥‡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"å¥¶":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"å¥¹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"å¦¹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"å§‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"åª½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"å­¸":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"å®ƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"å®Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"å®¶":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"å¯«":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"å°±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"å·±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"å¹«":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"åºŠ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"å¼Ÿ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"å¼µ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"å½©":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"å¾ˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"å¾Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"å¾—":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"å¿«":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"æ€":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"æ¯":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"æ‚¨":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"æƒ…":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"æƒ³":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"æ…¢":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"æˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"æˆ²":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"æ‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"æŠŠ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"æ‹¿":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"æƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"æ”¶":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"æ”¾":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"æ–°":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"æ–¼":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"æ—¥":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"æ™‚":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"æš–":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"æ›´":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"æœƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"æ¡Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"æ£‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"æ¥š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"æ¨‚":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"æ¨¹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"æ¬¡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"æ­Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"æ­¡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"æ­£":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"æ¯":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"æ°´":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"æ²’":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"æ²¹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"æ´—":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"æ·¨":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"æ¸…":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"æ¸¯":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"æ¸¸":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"æº«":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"æ»´":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"æ¼‚":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"æ¾†":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"ç‡ˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"çˆ¸":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"ç‰‡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"ç":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"ç ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"ç­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"ç”Ÿ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"çœŸ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"çŸ¥":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"çŸ­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"ç¥":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"ç¥":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"ç¦":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"ç¨®":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"ç©º":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"ç©¿":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"ç¬‘":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"ç¬¬":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"ç®":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"ç³–":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"çµ¦":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"ç·š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"ç¼¸":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"è":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"è½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"è„«":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"è‡ª":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"èˆ¹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"èŠ½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"è‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"èœ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"è½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"è‘‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"è‘—":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"è™¹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"èŸ²":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"è¦":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"è¦‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"è¨˜":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"è©±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"èª":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"è¬":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"è®Š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"è¶£":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"è·‘":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"è·Ÿ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"è·³":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"èº«":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"èºº":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"è¼•":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"é€":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"éŠ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"é":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"é“":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"éƒ½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"é…’":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"é‡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"é‡‘":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"é™¢":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"é™£":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"é™¤":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"é™½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"é›™":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"é›¨":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"é›²":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"éœ€":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"éœ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"é ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"é¢":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"é‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"éŸ³":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"é¡†":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"é¢¨":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"é¦™":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"é¦¬":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"é­š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"é³¥":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"éµ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"é»‘":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"é»":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"}};
                
                const brotherWords_1down = {"ä¸€åŠ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"ä¸€é™£":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"ä¸€é›™":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"ä¸€é»":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"ä¸Šæ¡Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"äº‹æƒ…":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"äº«å—":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"ä»Šå¤©":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"ä¼‘æ¯":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"ä½œå¤¢":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"å‰é¢":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"åŠ æ²¹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"å‡é«˜":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"å¡ç‰‡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"å–œæ­¡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"å›å®¶":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"åœ‹ç‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"å¤–å…¬":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"å¤©ç©º":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"å¤©éµ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"å¤ªé™½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"å¥¶å¥¶":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"å¥½åƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"å¦¹å¦¹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"åª½åª½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"å¼Ÿå¼Ÿ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"æ€éº¼":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"æ”¾å­¸":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"æ–°èŠ½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"æ–¼æ˜¯":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"æœ‰è¶£":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"æ°´é¢":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"æ²’æœ‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"æ´—æ·¨":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"æ¸…æ¥š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"æ¸¯å£":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"æº«æš–":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"æ¼‚äº®":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"æ¾†æ°´":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"çˆ¸çˆ¸":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"çç ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"ç”Ÿæ—¥":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"ç™½é›²":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"çŸ¥é“":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"ç¥ç¦":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"ç¥å¥‡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"ç¨®å­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"è‡ªå·±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"èŠ±åœ’":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"èŠ±è‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"è‰åœ°":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"è½ä¸‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"è‘‰å­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"è¦‹è":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-4"},"è¨˜å¾—":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"èªçœŸ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"èªªè©±":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"è¬è¬":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"è®ŠåŒ–":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"è®Šæˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"èµ·åºŠ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"è·Ÿç­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"è·¯ç‡ˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"èº«ä¸Š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"è¼•å¿«":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-2"},"éŠæˆ²":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"éå¾Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"é‡‘é­š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"é•·ç·š":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"é–‹å§‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"é™¢å­":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"é™ªä¼´":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"é™½å…‰":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"é›¨é‹":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"éœ€è¦":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-5"},"é¢¨ç®":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"é¦¬è·¯":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"é­šç¼¸":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-8"},"ä¸€æœƒå…’":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-12"},"å¤§æƒé™¤":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"},"å®¶å®¶é…’":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-6"},"æ£‰èŠ±ç³–":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-7"},"ç¬¬ä¸€æ¬¡":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-11"},"éœéœçš„":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-1"},"éŸ³æ¨‚æœƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-3"},"èªªèªªç¬‘ç¬‘":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"è·‘è·‘è·³è·³":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-10"},"é«˜é«˜ä½ä½":{"level":0,"lastReview":now,"nextReview":now,"source":"1ä¸‹-9"}};
                
                // äºŒä¸Šçš„å­—è©è³‡æ–™ï¼ˆç¬¬1-12èª²ï¼‰
                const brotherChars_2up = {"ä¸­":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"ä¹¾":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"ä»¥":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"ä¼¸":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"ä½†":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"ä½":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"å‡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"å……":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"å…¨":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"å…·":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"å†’":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å†¬":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"å†°":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å†·":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"åˆ‡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"åˆ’":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"åŠ›":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"å‹•":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"åŒ—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"åˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"å”":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"å—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"å»":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"åŸ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"å":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"å”":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"åª":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"å«":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"å¯":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"å¸":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"å":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"å¹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"å’ª":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å“‡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"å“ˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"å“ª":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"å–":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"å–®":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"å˜´":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"å› ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"åœ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"åœ“":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"åœ˜":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"åŸ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"åŸ”":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"å ¡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"å¤œ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"å¤¾":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"å¦‚":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"å¦™":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å¨˜":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"å¨¶":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"å­£":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"å®¢":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"å®¹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"å¯’":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"å°‘":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"å±…":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å±‹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"å··":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"å¸Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"å¸«":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"å¸¶":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"å¹´":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"å¹¸":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å¹¾":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"å¾€":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"å¾…":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"å¿˜":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"å¿™":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"å¿µ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æ€":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"æ€¥":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æ„‰":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"æ„":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"æ„›":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"æ…Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"æˆ´":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æ‰":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æ‰“":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"æ‰®":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"æ‹”":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"æ•":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"æ§":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"æ’":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"æ¥":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"æ–":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"æ“":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"æ•…":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"æ•¢":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"æ–¹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"æ—…":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"æ˜":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"æ˜¥":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"æš‘":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"æ›¸":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"æ›¹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"æœ€":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"æœˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"æœ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æœ›":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"æœŸ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"æœ¬":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"æ±":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"æ—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"æŸ±":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"æŸ¿":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"æ¢¨":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"æ£’":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"æ£®":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"æ£µ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"æ¬£":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"æ­¡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"æ­²":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"æ±—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"æ²™":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æ²³":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"æ³³":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"æ´‹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æ´»":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"æ·¡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"æ·º":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æ»¿":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"æ¿ƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"ç£":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"ç«":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"çƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"ç„¶":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"ç…™":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"ç†±":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"ç‰ ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"ç¾":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"ç“¶":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"ç”²":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"ç•ª":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"ç™¼":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"ç›¸":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"çŸ³":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"ç¢—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"ç«Ÿ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"ç­†":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"ç²—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"ç¶»":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"ç¶ ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"ç·Š":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"ç½©":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"è€":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"èŠ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"è°":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"è‡º":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"èˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"èŒ„":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"è·":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"è˜­":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"è›‹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"è´":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"è¶":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"è£³":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"è¤‡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"è¨±":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"èª":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"è©²":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"è²¨":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"èµ°":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"è¶Š":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"è·‘":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"è¼ª":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"è½‰":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"è¿‘":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"è¿":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"é‹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"é€²":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"éŠ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"éƒ¨":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"é„‰":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"é…":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"é®":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"é›£":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"é›–":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"é›ª":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"é›²":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"éœ§":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"é¢":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"é ‚":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"é ˜":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"é£¯":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"é¤":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"é¦™":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"é´‰":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"é¶´":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"é»ƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"é¼“":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"é½Š":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"}};
                
                const brotherWords_2up = {"ä¸€é½Š":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"ä¸Šåˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"ä¸æ•¢":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"ä¸­ç§‹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"å”å”":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"å³å¿™":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"å¯ä»¥":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"åå­—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"å‘¼å–Š":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"å˜´å”‡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"å˜´å·´":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"å››å­£":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"åœ“åœ“":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"åŸå ¡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"å¤œæ™š":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"å¤§å®¶":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å¤©é»‘":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"å¤¾é¤¡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"å¦‚ä½•":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"å¦™äº‹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å®¶äºº":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"å®¶é„‰":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"å¯’å†·":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"å°é®":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"å±…ç„¶":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å¸Œæœ›":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"å¹´ç´€":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"å¹´è²¨":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"å¹¸ç¦":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å½©ç­†":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"æ€å¿µ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æ„‰å¿«":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"æ…Œå¼µ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"æˆç‚º":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"æ‰“æ‰®":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"æ‹”æ²³":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"æ•é­š":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"æ§èŠ±":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"æ¥è‘—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"æ–é ­":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"æ•…äº‹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"æ–°å¨˜":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"æ–¹æ³•":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"æ—…è¡Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"æ—©é¤":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"æ˜¥ç¯€":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"æš‘å‡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"æ›¸é¦™":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"æ›¹æ“":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"æœ€å¾Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"æœŸå¾…":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"æ±è¥¿":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"æŸ±å­":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"æ£®æ—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"æ¨¡æ¨£":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"æ¬£å–œ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"æ¯”è³½":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"æ±—æ°´":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"æ²™å­":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æ´»å‹•":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"æµ·æ´‹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"æ·¡æ·¡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"æ»¿è¡—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"ç«é‹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"çƒé´‰":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"ç„¶å¾Œ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"ç…™ç«":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"ç†±çµ¡":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"ç†±é¬§":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"ç‰ å€‘":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"ç¾åœ¨":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"ç“¶å­":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"ç”¨åŠ›":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"ç•ªèŒ„":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"ç™¼ç¾":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"ç›¸å":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"çŸ³é ­":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"ç¢—å…¬":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"ç«Ÿç„¶":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"ç¬‘å®¹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"ç¬‘è‡‰":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"ç­‰å¾…":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"ç°¡å–®":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"ç²—å¤§":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"ç¶»æ”¾":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"ç¾å¦™":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"ç¾éº—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"ç¿…è†€":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"è€å¸«":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"èŠå¤©":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"è°æ˜":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"è‡ºç£":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"èˆè€…":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"è‘—æ€¥":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"è´è¶":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-3"},"è¡£æœ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"è¡£è£³":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"è¨±å¤š":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"èªè­˜":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"èª²æœ¬":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-1"},"èµ°é€²":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"èµ·å¸":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"è¶Šå—":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"è·‘æ­¥":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"è¼ªå­":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"è½‰å‹•":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"è¿‘æµ·":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-5"},"éŠå®¢":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"éƒ¨åˆ†":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"é›–ç„¶":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"é›£é“":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-8"},"é›ªæ¢¨":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"é¢å…·":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-11"},"é¢¨ä¹¾":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"é¦–å…ˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-9"},"åœ“é¼“é¼“":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"å¤§æœƒèˆ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"å¹´å¤œé£¯":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-10"},"ç•ªèŒ„é†¬":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"ç¬‘å’ªå’ª":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-12"},"é‹å‹•æœƒ":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-4"},"é‡‘é»ƒè‰²":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"},"å››å››æ–¹æ–¹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-2"},"å·¦æ€å³æƒ³":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-7"},"è¦ªæœ‹å¥½å‹":{"level":0,"lastReview":now,"nextReview":now,"source":"2ä¸Š-6"}};
                
                Object.entries(brotherChars).forEach(([char, data]) => {
                    learnedCharacters.set(char, data);
                });
                
                Object.entries(brotherWords).forEach(([word, data]) => {
                    learnedWords.set(word, data);
                });
                
                // åˆä½µä¸€ä¸‹çš„å­—è©
                Object.entries(brotherChars_1down).forEach(([char, data]) => {
                    learnedCharacters.set(char, data);
                });
                
                Object.entries(brotherWords_1down).forEach(([word, data]) => {
                    learnedWords.set(word, data);
                });
                
                // åˆä½µäºŒä¸Šçš„å­—è©
                Object.entries(brotherChars_2up).forEach(([char, data]) => {
                    learnedCharacters.set(char, data);
                });
                
                Object.entries(brotherWords_2up).forEach(([word, data]) => {
                    learnedWords.set(word, data);
                });
                
                console.log('âœ“ è¼‰å…¥å“¥å“¥é è¨­è³‡æ–™:', learnedCharacters.size, 'å€‹å­—,', learnedWords.size, 'å€‹è©');
                }
            }
        }

        function resetFilterButtons() {
            document.querySelectorAll('.button-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.button-filter')[0].classList.add('active');
            document.querySelectorAll('.button-filter')[5].classList.add('active');
        }

        // ==================== History ç›¸é—œå‡½å¼ ====================
        
        function generateId() {
            return Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }

        function loadHistory() {
            const saved = localStorage.getItem(`learner_${currentLearner}_history`);
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    console.error('è¼‰å…¥ History å¤±æ•—:', e);
                    return [];
                }
            }
            return [];
        }

        function saveHistory(history) {
            try {
                localStorage.setItem(`learner_${currentLearner}_history`, JSON.stringify(history));
            } catch (e) {
                console.error('å„²å­˜ History å¤±æ•—:', e);
            }
        }

        function appendHistory(entry) {
            const history = loadHistory();
            
            const fullEntry = {
                id: generateId(),
                ts: new Date().toISOString(),
                learner: currentLearner,
                ...entry
            };
            
            history.push(fullEntry);
            
            if (history.length > HISTORY_MAX_SIZE) {
                history.splice(0, history.length - HISTORY_MAX_SIZE);
            }
            
            saveHistory(history);
        }

        // ==================== è³‡æ–™è¼‰å…¥/å„²å­˜ ====================

        function loadData() {
            console.log('ğŸ“¥ é–‹å§‹è¼‰å…¥è³‡æ–™...');
            
            // è¼‰å…¥ä¸Šæ¬¡é¸æ“‡çš„å­¸ç¿’è€…
            const savedLearner = localStorage.getItem('currentLearner');
            if (savedLearner) {
                currentLearner = savedLearner;
                document.querySelectorAll('.learner-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`.learner-btn.${savedLearner}`).classList.add('active');
                
                const name = savedLearner === 'brother' ? 'å“¥å“¥' : 'å¦¹å¦¹';
                document.getElementById('currentLearnerName').textContent = name;
            }
            
            console.log(`ç•¶å‰å­¸ç¿’è€…: ${currentLearner}`);
            
            loadCurrentLearnerData();
            
            console.log(`âœ“ å·²è¼‰å…¥ ${learnedCharacters.size} å€‹å­—, ${learnedWords.size} å€‹è©`);
            
            updateUI();
            
            console.log('âœ“ è³‡æ–™è¼‰å…¥å®Œæˆ');
        }

        function saveData() {
            saveCurrentLearnerData();
        }

        function createNewItem() {
            const now = Date.now();
            return {
                level: 0,
                lastReview: now,
                nextReview: now
            };
        }

        function calculateNextReview(level) {
            const now = Date.now();
            if (level >= REVIEW_INTERVALS.length) {
                return now + (60 * 24 * 60 * 60 * 1000);
            }
            const days = REVIEW_INTERVALS[level];
            return now + (days * 24 * 60 * 60 * 1000);
        }

        function needsReview(item) {
            return Date.now() >= item.nextReview;
        }

        // ==================== åŒ¯å‡º/åŒ¯å…¥åŠŸèƒ½ ====================

        function viewHistory() {
            const history = loadHistory();
            
            if (history.length === 0) {
                alert('ç›®å‰æ²’æœ‰ç´€éŒ„');
                return;
            }
            
            const recent = history.slice(-20).reverse();
            const learnerName = currentLearner === 'brother' ? 'å“¥å“¥' : 'å¦¹å¦¹';
            
            let message = `${learnerName}çš„æœ€è¿‘ 20 ç­†è®Šæ›´ç´€éŒ„ï¼š\n\n`;
            recent.forEach((entry, index) => {
                const time = new Date(entry.ts).toLocaleString('zh-TW');
                const entityInfo = entry.key ? `${entry.entityType}: ${entry.key}` : entry.entityType;
                
                let metaInfo = '';
                if (entry.meta) {
                    if (entry.meta.fromWord) metaInfo = ` (ä¾†è‡ªè©: ${entry.meta.fromWord})`;
                    if (entry.meta.filename) metaInfo = ` (æª”æ¡ˆ: ${entry.meta.filename})`;
                    if (entry.meta.count) metaInfo = ` (æ•¸é‡: ${entry.meta.count})`;
                }
                
                message += `${recent.length - index}. [${time}] ${entry.action} - ${entityInfo}${metaInfo}\n`;
            });
            
            alert(message);
        }

        function exportData() {
            // å„²å­˜ç•¶å‰è³‡æ–™
            saveCurrentLearnerData();
            
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10);
            const timeStr = now.toTimeString().slice(0, 5).replace(':', '');
            const filename = `ä¸­æ–‡å­¸ç¿’è¨˜éŒ„_é›™äººç‰ˆ_${dateStr}_${timeStr}.json`;
            
            // åŒ¯å‡ºå…©å€‹å­¸ç¿’è€…çš„è³‡æ–™
            const exportData = {
                version: "3.0-dual",
                exportedAt: now.toISOString(),
                learners: {
                    brother: {
                        name: "å“¥å“¥",
                        data: JSON.parse(localStorage.getItem('learner_brother_data') || '{"characters":{},"words":{}}'),
                        history: JSON.parse(localStorage.getItem('learner_brother_history') || '[]')
                    },
                    sister: {
                        name: "å¦¹å¦¹",
                        data: JSON.parse(localStorage.getItem('learner_sister_data') || '{"characters":{},"words":{}}'),
                        history: JSON.parse(localStorage.getItem('learner_sister_history') || '[]')
                    }
                },
                currentLearner: currentLearner
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            appendHistory({
                action: 'EXPORT',
                entityType: 'system',
                key: null,
                before: null,
                after: null,
                meta: { filename: filename }
            });
            
            showNotification('å…©äººè³‡æ–™å·²åŒ¯å‡ºï¼');
        }

        function triggerImport() {
            document.getElementById('importFile').click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    // æª¢æŸ¥æ˜¯å¦ç‚ºé›™äººç‰ˆæ ¼å¼
                    if (imported.version === "3.0-dual" && imported.learners) {
                        // åŒ¯å…¥å“¥å“¥çš„è³‡æ–™
                        if (imported.learners.brother) {
                            localStorage.setItem('learner_brother_data', JSON.stringify(imported.learners.brother.data));
                            if (imported.learners.brother.history) {
                                localStorage.setItem('learner_brother_history', JSON.stringify(imported.learners.brother.history));
                            }
                        }
                        
                        // åŒ¯å…¥å¦¹å¦¹çš„è³‡æ–™
                        if (imported.learners.sister) {
                            localStorage.setItem('learner_sister_data', JSON.stringify(imported.learners.sister.data));
                            if (imported.learners.sister.history) {
                                localStorage.setItem('learner_sister_history', JSON.stringify(imported.learners.sister.history));
                            }
                        }
                        
                        // æ¢å¾©ä¸Šæ¬¡çš„å­¸ç¿’è€…é¸æ“‡
                        if (imported.currentLearner) {
                            switchLearner(imported.currentLearner);
                        } else {
                            loadCurrentLearnerData();
                            updateUI();
                        }
                        
                        showNotification('å…©äººè³‡æ–™åŒ¯å…¥æˆåŠŸï¼');
                    } else {
                        // èˆŠæ ¼å¼æˆ–å–®äººæ ¼å¼ï¼ŒåŒ¯å…¥åˆ°ç•¶å‰å­¸ç¿’è€…
                        let dataToImport;
                        if (imported.data) {
                            dataToImport = imported.data;
                        } else {
                            dataToImport = imported;
                        }
                        
                        learnedCharacters.clear();
                        learnedWords.clear();
                        
                        if (dataToImport.characters) {
                            if (Array.isArray(dataToImport.characters)) {
                                dataToImport.characters.forEach(char => {
                                    learnedCharacters.set(char, createNewItem());
                                });
                            } else {
                                Object.entries(dataToImport.characters).forEach(([char, data]) => {
                                    learnedCharacters.set(char, data);
                                });
                            }
                        }
                        
                        if (dataToImport.words) {
                            if (Array.isArray(dataToImport.words)) {
                                dataToImport.words.forEach(word => {
                                    learnedWords.set(word, createNewItem());
                                });
                            } else {
                                Object.entries(dataToImport.words).forEach(([word, data]) => {
                                    learnedWords.set(word, data);
                                });
                            }
                        }
                        
                        if (imported.history && Array.isArray(imported.history)) {
                            saveHistory(imported.history);
                        }
                        
                        saveData();
                        updateUI();
                        
                        const learnerName = currentLearner === 'brother' ? 'å“¥å“¥' : 'å¦¹å¦¹';
                        showNotification(`å·²åŒ¯å…¥åˆ°${learnerName}çš„è¨˜éŒ„ï¼`);
                    }
                    
                    appendHistory({
                        action: 'IMPORT',
                        entityType: 'system',
                        key: null,
                        before: null,
                        after: null,
                        meta: { filename: file.name }
                    });
                    
                    event.target.value = '';
                    
                } catch (error) {
                    alert('åŒ¯å…¥å¤±æ•—ï¼š' + error.message);
                    event.target.value = '';
                }
            };
            
            reader.readAsText(file);
        }

        // ==================== å­—/è©ç®¡ç† ====================

        function addCharacter() {
            const input = document.getElementById('charInput');
            const chars = input.value.trim();
            
            if (!chars) {
                alert('è«‹è¼¸å…¥ä¸­æ–‡å­—ï¼');
                return;
            }

            const chineseChars = chars.match(/[\u4e00-\u9fa5]/g) || [];
            
            if (chineseChars.length === 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ä¸­æ–‡å­—ï¼');
                return;
            }

            chineseChars.forEach(char => {
                if (!learnedCharacters.has(char)) {
                    const item = createNewItem();
                    learnedCharacters.set(char, item);
                    
                    appendHistory({
                        action: 'ADD_CHAR',
                        entityType: 'char',
                        key: char,
                        before: null,
                        after: item,
                        meta: {}
                    });
                }
            });
            
            input.value = '';
            saveData();
            updateUI();
            updateSemesterCounts(); // æ›´æ–°å­¸æœŸçµ±è¨ˆ
            
            showNotification(`æˆåŠŸæ·»åŠ  ${chineseChars.length} å€‹å­—ï¼`);
        }

        function addWord() {
            const input = document.getElementById('wordInput');
            const text = input.value.trim();
            
            if (!text) {
                alert('è«‹è¼¸å…¥è©å½™ï¼');
                return;
            }

            const words = text.split(/[\s,ï¼Œã€]+/).filter(w => w.length > 0);
            
            if (words.length === 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„è©å½™ï¼');
                return;
            }

            let addedCount = 0;
            words.forEach(word => {
                const cleanWord = word.match(/[\u4e00-\u9fa5]+/g);
                if (cleanWord && cleanWord[0].length >= 2) {
                    const finalWord = cleanWord[0];
                    
                    if (!learnedWords.has(finalWord)) {
                        const wordItem = createNewItem();
                        learnedWords.set(finalWord, wordItem);
                        
                        appendHistory({
                            action: 'ADD_WORD',
                            entityType: 'word',
                            key: finalWord,
                            before: null,
                            after: wordItem,
                            meta: {}
                        });
                    }
                    
                    finalWord.split('').forEach(char => {
                        if (!learnedCharacters.has(char)) {
                            const charItem = createNewItem();
                            learnedCharacters.set(char, charItem);
                            
                            appendHistory({
                                action: 'ADD_CHAR',
                                entityType: 'char',
                                key: char,
                                before: null,
                                after: charItem,
                                meta: { source: 'word', fromWord: finalWord }
                            });
                        }
                    });
                    
                    addedCount++;
                }
            });
            
            if (addedCount > 0) {
                input.value = '';
                saveData();
                updateUI();
                updateSemesterCounts(); // æ›´æ–°å­¸æœŸçµ±è¨ˆ
                showNotification(`æˆåŠŸæ·»åŠ  ${addedCount} å€‹è©å½™ï¼`);
            } else {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ä¸­æ–‡è©å½™ï¼ˆè‡³å°‘å…©å€‹å­—ï¼‰ï¼');
            }
        }

        function showBulkInput() {
            document.getElementById('bulkModal').classList.add('active');
        }

        function closeBulkInput() {
            document.getElementById('bulkModal').classList.remove('active');
            document.getElementById('bulkInput').value = '';
        }

        function addBulkCharacters() {
            const input = document.getElementById('bulkInput');
            const text = input.value.trim();
            
            if (!text) {
                alert('è«‹è¼¸å…¥ä¸­æ–‡å­—ï¼');
                return;
            }

            const chineseChars = text.match(/[\u4e00-\u9fa5]/g) || [];
            
            if (chineseChars.length === 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ä¸­æ–‡å­—ï¼');
                return;
            }

            const addedChars = [];
            chineseChars.forEach(char => {
                if (!learnedCharacters.has(char)) {
                    const item = createNewItem();
                    learnedCharacters.set(char, item);
                    addedChars.push(char);
                }
            });
            
            if (addedChars.length > 0) {
                appendHistory({
                    action: 'ADD_BULK_CHARS',
                    entityType: 'char',
                    key: null,
                    before: null,
                    after: null,
                    meta: { chars: addedChars, count: addedChars.length }
                });
            }
            
            saveData();
            updateUI();
            closeBulkInput();
            
            if (addedChars.length > 0) {
                showNotification(`æˆåŠŸæ·»åŠ  ${addedChars.length} å€‹å­—ï¼`);
            } else {
                showNotification('æ²’æœ‰æ–°å¢æ–°å­—ï¼ˆéƒ½å·²å­˜åœ¨ï¼‰');
            }
        }

        // ==================== è¤‡ç¿’åŠŸèƒ½ ====================

        function startCharReview() {
            const needReview = Array.from(learnedCharacters.entries())
                .filter(([char, data]) => needsReview(data))
                .map(([char]) => char);

            if (needReview.length === 0) {
                alert('ç›®å‰æ²’æœ‰éœ€è¦è¤‡ç¿’çš„å­—ï¼ğŸ‰\næ‰€æœ‰çš„å­—éƒ½é‚„åœ¨è¨˜æ†¶æœŸå…§ã€‚');
                return;
            }
            
            reviewType = 'char';
            reviewList = shuffleArray(needReview);
            reviewIndex = 0;
            showReview();
            document.getElementById('reviewModal').classList.add('active');
        }

        function startWordReview() {
            const needReview = Array.from(learnedWords.entries())
                .filter(([word, data]) => needsReview(data))
                .map(([word]) => word);

            if (needReview.length === 0) {
                alert('ç›®å‰æ²’æœ‰éœ€è¦è¤‡ç¿’çš„è©ï¼ğŸ‰\næ‰€æœ‰çš„è©éƒ½é‚„åœ¨è¨˜æ†¶æœŸå…§ã€‚');
                return;
            }
            
            reviewType = 'word';
            reviewList = shuffleArray(needReview);
            reviewIndex = 0;
            showReview();
            document.getElementById('reviewModal').classList.add('active');
        }

        function showReview() {
            if (reviewIndex >= reviewList.length) {
                document.getElementById('reviewProgress').textContent = 'ğŸ‰ ä»Šå¤©çš„è¤‡ç¿’å®Œæˆäº†ï¼';
                document.getElementById('reviewCharacter').textContent = 'å¤ªæ£’äº†ï¼';
                document.getElementById('reviewHint').textContent = 'ç¹¼çºŒä¿æŒï¼Œæ˜å¤©è¦‹ï¼';
                return;
            }

            const current = reviewList[reviewIndex];
            const total = reviewList.length;
            const typeText = reviewType === 'char' ? 'å­—' : 'è©';
            
            const data = reviewType === 'char' 
                ? learnedCharacters.get(current) 
                : learnedWords.get(current);
            
            const level = data.level;
            const levelText = level === 0 ? 'æ–°å­¸' : `ç¬¬${level}æ¬¡è¤‡ç¿’`;
            
            document.getElementById('reviewProgress').textContent = `ç¬¬ ${reviewIndex + 1} / ${total} å€‹${typeText} (${levelText})`;
            document.getElementById('reviewCharacter').textContent = current;
            document.getElementById('reviewHint').textContent = 'èªè­˜é€™å€‹å­—/è©å—ï¼Ÿ';
        }

        function markCorrect() {
            if (reviewIndex >= reviewList.length) {
                return;
            }

            const current = reviewList[reviewIndex];
            const dataMap = reviewType === 'char' ? learnedCharacters : learnedWords;
            const data = dataMap.get(current);
            
            const before = { ...data };
            
            data.level = Math.min(data.level + 1, 4); // æœ€é«˜ Level 4
            data.lastReview = Date.now();
            data.nextReview = calculateNextReview(data.level);
            
            dataMap.set(current, data);
            
            appendHistory({
                action: 'REVIEW_CORRECT',
                entityType: reviewType,
                key: current,
                before: before,
                after: { ...data },
                meta: {}
            });
            
            saveData();
            
            const encouragement = ['å¤ªæ£’äº†ï¼', 'å¾ˆå¥½ï¼', 'çœŸå²å®³ï¼', 'ç¹¼çºŒåŠ æ²¹ï¼', 'ç­”å°äº†ï¼'][Math.floor(Math.random() * 5)];
            document.getElementById('reviewHint').textContent = `âœ“ ${encouragement}`;
            
            setTimeout(() => {
                reviewIndex++;
                showReview();
                updateUI();
            }, 800);
        }

        function markIncorrect() {
            if (reviewIndex >= reviewList.length) {
                return;
            }

            const current = reviewList[reviewIndex];
            const dataMap = reviewType === 'char' ? learnedCharacters : learnedWords;
            const data = dataMap.get(current);
            
            const before = { ...data };
            
            data.level = Math.max(data.level - 1, 0);
            data.lastReview = Date.now();
            data.nextReview = calculateNextReview(data.level);
            
            dataMap.set(current, data);
            
            appendHistory({
                action: 'REVIEW_INCORRECT',
                entityType: reviewType,
                key: current,
                before: before,
                after: { ...data },
                meta: {}
            });
            
            saveData();
            
            document.getElementById('reviewHint').textContent = 'âœ— æ²’é—œä¿‚ï¼Œå¤šç·´ç¿’å°±æœƒè¨˜ä½äº†ï¼';
            
            setTimeout(() => {
                reviewIndex++;
                showReview();
                updateUI();
            }, 1000);
        }

        function endReview() {
            document.getElementById('reviewModal').classList.remove('active');
            reviewList = [];
            reviewIndex = 0;
            updateUI();
        }

        // ==================== æ”¾å¤§é¡¯ç¤ºèˆ‡èª¿æ•´ ====================

        let currentEnlargedItem = null;
        let currentEnlargedType = null;

        function showEnlarged(text) {
            let data;
            if (learnedCharacters.has(text)) {
                currentEnlargedType = 'char';
                data = learnedCharacters.get(text);
                document.getElementById('enlargeLevel').textContent = `Level ${data.level}`;
                updateLevelButtons(data.level);
            } else if (learnedWords.has(text)) {
                currentEnlargedType = 'word';
                data = learnedWords.get(text);
                document.getElementById('enlargeLevel').textContent = `Level ${data.level}`;
                updateLevelButtons(data.level);
            }
            
            // é¡¯ç¤ºä¾†æºè³‡è¨Š
            const sourceElement = document.getElementById('enlargeSource');
            const sourceTextElement = document.getElementById('enlargeSourceText');
            if (data && data.source) {
                // source æ ¼å¼ï¼š'1ä¸Š-1' è¡¨ç¤ºä¸€ä¸Šç¬¬1èª²
                const parts = data.source.split('-');
                if (parts.length === 2) {
                    sourceTextElement.textContent = `${parts[0]}ç¬¬${parts[1]}èª²`;
                } else {
                    // å‘ä¸‹ç›¸å®¹èˆŠæ ¼å¼
                    sourceTextElement.textContent = `ä¸€ä¸Šç¬¬${data.source}èª²`;
                }
                sourceElement.style.display = 'flex';
            } else {
                sourceElement.style.display = 'none';
            }
            
            currentEnlargedItem = text;
            const charElement = document.getElementById('enlargeCharacter');
            charElement.textContent = text;
            
            let initialSize;
            if (text.length === 1) {
                initialSize = 10;
                charElement.classList.remove('multi-char');
            } else if (text.length === 2) {
                initialSize = 8;
                charElement.classList.add('multi-char');
            } else {
                initialSize = 6;
                charElement.classList.add('multi-char');
            }
            
            document.getElementById('fontSizeSlider').value = initialSize;
            charElement.style.fontSize = initialSize + 'rem';
            
            document.getElementById('enlargeModal').classList.add('active');
        }

        function updateLevelButtons(currentLevel) {
            // æ›´æ–° Level æŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹
            const modal = document.getElementById('enlargeModal');
            const buttons = modal.querySelectorAll('.button-filter[onclick^="setLevel"]');
            buttons.forEach((btn, index) => {
                if (index === currentLevel) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function adjustFontSize(value) {
            const charElement = document.getElementById('enlargeCharacter');
            charElement.style.fontSize = value + 'rem';
        }

        function setLevel(newLevel) {
            if (!currentEnlargedItem) return;
            
            const dataMap = currentEnlargedType === 'char' ? learnedCharacters : learnedWords;
            const data = dataMap.get(currentEnlargedItem);
            
            if (!data) return;
            
            const before = { ...data };
            
            // å¦‚æœé»æ“Šç›¸åŒçš„ Levelï¼Œä¸åšä»»ä½•äº‹
            if (newLevel === data.level) {
                return;
            }
            
            // é™åˆ¶ Level ç¯„åœç‚º 0-4
            newLevel = Math.max(0, Math.min(4, newLevel));
            
            data.level = newLevel;
            data.lastReview = Date.now();
            data.nextReview = calculateNextReview(newLevel);
            
            dataMap.set(currentEnlargedItem, data);
            
            appendHistory({
                action: 'SET_LEVEL',
                entityType: currentEnlargedType,
                key: currentEnlargedItem,
                before: before,
                after: { ...data },
                meta: { newLevel: newLevel }
            });
            
            saveData();
            
            document.getElementById('enlargeLevel').textContent = `Level ${newLevel}`;
            updateLevelButtons(newLevel);
            updateUI();
            
            const levelNames = ['æ–°å­¸', 'èªè­˜', 'ç†Ÿæ‚‰', 'æŒæ¡', 'ç²¾é€š'];
            showNotification(`å·²è¨­å®šç‚º ${levelNames[newLevel]} (Level ${newLevel})`);
        }

        function deleteFromEnlarge() {
            if (!currentEnlargedItem || !currentEnlargedType) {
                alert('ç„¡æ³•åˆªé™¤ï¼šæœªé¸æ“‡é …ç›®');
                return;
            }
            
            const itemType = currentEnlargedType === 'char' ? 'å­—' : 'è©';
            const confirmMessage = `ç¢ºå®šè¦åˆªé™¤${itemType}ã€Œ${currentEnlargedItem}ã€å—ï¼Ÿ\n\nåˆªé™¤å¾Œå°‡ç„¡æ³•å¾©åŸã€‚`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            try {
                const dataMap = currentEnlargedType === 'char' ? learnedCharacters : learnedWords;
                const beforeData = dataMap.get(currentEnlargedItem);
                const before = beforeData ? { ...beforeData } : null;
                
                const deleted = dataMap.delete(currentEnlargedItem);
                
                if (!deleted) {
                    alert('åˆªé™¤å¤±æ•—ï¼šé …ç›®ä¸å­˜åœ¨');
                    return;
                }
                
                appendHistory({
                    action: currentEnlargedType === 'char' ? 'DELETE_CHAR' : 'DELETE_WORD',
                    entityType: currentEnlargedType,
                    key: currentEnlargedItem,
                    before: before,
                    after: null,
                    meta: {}
                });
                
                saveData();
                
                const itemName = currentEnlargedItem;
                closeEnlarge();
                
                updateUI();
                updateSemesterCounts(); // æ›´æ–°å­¸æœŸçµ±è¨ˆ
                
                setTimeout(() => {
                    showNotification(`âœ“ å·²åˆªé™¤ã€Œ${itemName}ã€`);
                }, 100);
                
            } catch (error) {
                alert('åˆªé™¤æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
            }
        }

        function editSource() {
            if (!currentEnlargedItem) return;
            
            const dataMap = currentEnlargedType === 'char' ? learnedCharacters : learnedWords;
            const data = dataMap.get(currentEnlargedItem);
            if (!data) return;
            
            // è§£æç•¶å‰ä¾†æº
            let currentSemester = '1ä¸Š';
            let currentLesson = '1';
            if (data.source) {
                const parts = data.source.split('-');
                if (parts.length === 2) {
                    currentSemester = parts[0];
                    currentLesson = parts[1];
                } else {
                    currentLesson = data.source;
                }
            }
            
            // å½ˆå‡ºè¼¸å…¥æ¡†
            const newSource = prompt(
                `ä¿®æ”¹ä¾†æº\n\næ ¼å¼ï¼šå­¸æœŸ-èª²è™Ÿ\nä¾‹å¦‚ï¼š1ä¸Š-1ã€1ä¸‹-3ã€2ä¸Š-5\n\nç•¶å‰ï¼š${currentSemester}-${currentLesson}`,
                `${currentSemester}-${currentLesson}`
            );
            
            if (newSource === null) return; // å–æ¶ˆ
            
            // é©—è­‰æ ¼å¼
            const trimmed = newSource.trim();
            if (!trimmed) {
                alert('ä¾†æºä¸èƒ½ç‚ºç©º');
                return;
            }
            
            const parts = trimmed.split('-');
            if (parts.length !== 2) {
                alert('æ ¼å¼éŒ¯èª¤ï¼è«‹ä½¿ç”¨ï¼šå­¸æœŸ-èª²è™Ÿ\nä¾‹å¦‚ï¼š1ä¸Š-1');
                return;
            }
            
            // é©—è­‰å­¸æœŸæ ¼å¼ï¼ˆ1ä¸Šã€1ä¸‹ã€2ä¸Šã€2ä¸‹ç­‰ï¼‰
            if (!/^[1-6][ä¸Šä¸‹]$/.test(parts[0])) {
                alert('å­¸æœŸæ ¼å¼éŒ¯èª¤ï¼æ‡‰ç‚ºï¼š1ä¸Šã€1ä¸‹ã€2ä¸Šã€2ä¸‹ç­‰');
                return;
            }
            
            // é©—è­‰èª²è™Ÿï¼ˆæ•¸å­—ï¼‰
            if (!/^\d+$/.test(parts[1])) {
                alert('èª²è™Ÿæ‡‰ç‚ºæ•¸å­—');
                return;
            }
            
            // æ›´æ–°ä¾†æº
            data.source = trimmed;
            saveData();
            
            // æ›´æ–°é¡¯ç¤º
            const sourceTextElement = document.getElementById('enlargeSourceText');
            sourceTextElement.textContent = `${parts[0]}ç¬¬${parts[1]}èª²`;
            
            showNotification(`âœ… å·²æ›´æ–°ä¾†æºç‚ºï¼š${parts[0]}ç¬¬${parts[1]}èª²`);
        }

        function closeEnlarge() {
            document.getElementById('enlargeModal').classList.remove('active');
            currentEnlargedItem = null;
            currentEnlargedType = null;
        }

        // ==================== ç¯©é¸åŠŸèƒ½ ====================

        function filterChars(level, btn) {
            // å¦‚æœé»æ“Šã€Œå…¨éƒ¨ã€
            if (level === 'all') {
                if (charFilter.has('all')) {
                    // å·²ç¶“æ˜¯å…¨éƒ¨ï¼Œä¸åšä»»ä½•äº‹
                    return;
                } else {
                    // åˆ‡æ›åˆ°å…¨éƒ¨ï¼Œæ¸…é™¤å…¶ä»–é¸æ“‡
                    charFilter.clear();
                    charFilter.add('all');
                }
            } else {
                // é»æ“Šå…·é«”çš„ Level
                if (charFilter.has('all')) {
                    // å¦‚æœç•¶å‰æ˜¯å…¨éƒ¨ï¼Œåˆ‡æ›åˆ°åªé¸é€™å€‹ Level
                    charFilter.clear();
                    charFilter.add(level);
                } else {
                    // è¤‡é¸æ¨¡å¼
                    if (charFilter.has(level)) {
                        // å–æ¶ˆé¸æ“‡
                        charFilter.delete(level);
                        // å¦‚æœå…¨éƒ¨å–æ¶ˆäº†ï¼Œè‡ªå‹•åˆ‡å›ã€Œå…¨éƒ¨ã€
                        if (charFilter.size === 0) {
                            charFilter.add('all');
                        }
                    } else {
                        // æ–°å¢é¸æ“‡
                        charFilter.add(level);
                    }
                }
            }
            
            updateCharsDisplay();
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const container = btn.parentElement;
            container.querySelectorAll('.button-filter').forEach(b => {
                const btnLevel = b.onclick.toString().match(/filterChars\(([^,]+),/)[1].replace(/['"]/g, '');
                // è™•ç†æ•¸å­—å’Œå­—ä¸²çš„æ¯”è¼ƒ
                const btnLevelNum = btnLevel === 'all' ? 'all' : parseInt(btnLevel);
                if (charFilter.has(btnLevelNum) || (btnLevelNum === 'all' && charFilter.has('all'))) {
                    b.classList.add('active');
                } else {
                    b.classList.remove('active');
                }
            });
        }

        function filterCharsBySemester(semester, btn) {
            // å¦‚æœé»æ“Šã€Œå…¨éƒ¨ã€
            if (semester === 'all') {
                if (charSemesterFilter.has('all')) {
                    // å·²ç¶“æ˜¯å…¨éƒ¨ï¼Œä¸åšä»»ä½•äº‹
                    return;
                } else {
                    // åˆ‡æ›åˆ°å…¨éƒ¨ï¼Œæ¸…é™¤å…¶ä»–é¸æ“‡
                    charSemesterFilter.clear();
                    charSemesterFilter.add('all');
                }
            } else {
                // é»æ“Šå…·é«”çš„å­¸æœŸ
                if (charSemesterFilter.has('all')) {
                    // å¦‚æœç•¶å‰æ˜¯å…¨éƒ¨ï¼Œåˆ‡æ›åˆ°åªé¸é€™å€‹å­¸æœŸ
                    charSemesterFilter.clear();
                    charSemesterFilter.add(semester);
                } else {
                    // è¤‡é¸æ¨¡å¼
                    if (charSemesterFilter.has(semester)) {
                        // å–æ¶ˆé¸æ“‡
                        charSemesterFilter.delete(semester);
                        // å¦‚æœå…¨éƒ¨å–æ¶ˆäº†ï¼Œè‡ªå‹•åˆ‡å›ã€Œå…¨éƒ¨ã€
                        if (charSemesterFilter.size === 0) {
                            charSemesterFilter.add('all');
                        }
                    } else {
                        // æ–°å¢é¸æ“‡
                        charSemesterFilter.add(semester);
                    }
                }
            }
            
            updateCharsDisplay();
            
            // æ›´æ–°èª²åˆ¥é¸é …ï¼ˆæ ¹æ“šæ–°é¸æ“‡çš„å­¸æœŸï¼‰
            updateLessonOptions();
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const container = btn.parentElement;
            container.querySelectorAll('.button-filter').forEach(b => {
                const btnSemester = b.onclick.toString().match(/filterCharsBySemester\(['"]([^'"]+)['"]/)[1];
                if (charSemesterFilter.has(btnSemester)) {
                    b.classList.add('active');
                } else {
                    b.classList.remove('active');
                }
            });
        }

        function filterWords(level, btn) {
            // å¦‚æœé»æ“Šã€Œå…¨éƒ¨ã€
            if (level === 'all') {
                if (wordFilter.has('all')) {
                    // å·²ç¶“æ˜¯å…¨éƒ¨ï¼Œä¸åšä»»ä½•äº‹
                    return;
                } else {
                    // åˆ‡æ›åˆ°å…¨éƒ¨ï¼Œæ¸…é™¤å…¶ä»–é¸æ“‡
                    wordFilter.clear();
                    wordFilter.add('all');
                }
            } else {
                // é»æ“Šå…·é«”çš„ Level
                if (wordFilter.has('all')) {
                    // å¦‚æœç•¶å‰æ˜¯å…¨éƒ¨ï¼Œåˆ‡æ›åˆ°åªé¸é€™å€‹ Level
                    wordFilter.clear();
                    wordFilter.add(level);
                } else {
                    // è¤‡é¸æ¨¡å¼
                    if (wordFilter.has(level)) {
                        // å–æ¶ˆé¸æ“‡
                        wordFilter.delete(level);
                        // å¦‚æœå…¨éƒ¨å–æ¶ˆäº†ï¼Œè‡ªå‹•åˆ‡å›ã€Œå…¨éƒ¨ã€
                        if (wordFilter.size === 0) {
                            wordFilter.add('all');
                        }
                    } else {
                        // æ–°å¢é¸æ“‡
                        wordFilter.add(level);
                    }
                }
            }
            
            updateWordsDisplay();
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const container = btn.parentElement;
            container.querySelectorAll('.button-filter').forEach(b => {
                const btnLevel = b.onclick.toString().match(/filterWords\(([^,]+),/)[1].replace(/['"]/g, '');
                // è™•ç†æ•¸å­—å’Œå­—ä¸²çš„æ¯”è¼ƒ
                const btnLevelNum = btnLevel === 'all' ? 'all' : parseInt(btnLevel);
                if (wordFilter.has(btnLevelNum) || (btnLevelNum === 'all' && wordFilter.has('all'))) {
                    b.classList.add('active');
                } else {
                    b.classList.remove('active');
                }
            });
        }

        function filterWordsBySemester(semester, btn) {
            // å¦‚æœé»æ“Šã€Œå…¨éƒ¨ã€
            if (semester === 'all') {
                if (wordSemesterFilter.has('all')) {
                    // å·²ç¶“æ˜¯å…¨éƒ¨ï¼Œä¸åšä»»ä½•äº‹
                    return;
                } else {
                    // åˆ‡æ›åˆ°å…¨éƒ¨ï¼Œæ¸…é™¤å…¶ä»–é¸æ“‡
                    wordSemesterFilter.clear();
                    wordSemesterFilter.add('all');
                }
            } else {
                // é»æ“Šå…·é«”çš„å­¸æœŸ
                if (wordSemesterFilter.has('all')) {
                    // å¦‚æœç•¶å‰æ˜¯å…¨éƒ¨ï¼Œåˆ‡æ›åˆ°åªé¸é€™å€‹å­¸æœŸ
                    wordSemesterFilter.clear();
                    wordSemesterFilter.add(semester);
                } else {
                    // è¤‡é¸æ¨¡å¼
                    if (wordSemesterFilter.has(semester)) {
                        // å–æ¶ˆé¸æ“‡
                        wordSemesterFilter.delete(semester);
                        // å¦‚æœå…¨éƒ¨å–æ¶ˆäº†ï¼Œè‡ªå‹•åˆ‡å›ã€Œå…¨éƒ¨ã€
                        if (wordSemesterFilter.size === 0) {
                            wordSemesterFilter.add('all');
                        }
                    } else {
                        // æ–°å¢é¸æ“‡
                        wordSemesterFilter.add(semester);
                    }
                }
            }
            
            updateWordsDisplay();
            
            // æ›´æ–°èª²åˆ¥é¸é …ï¼ˆæ ¹æ“šæ–°é¸æ“‡çš„å­¸æœŸï¼‰
            updateLessonOptions();
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const container = btn.parentElement;
            container.querySelectorAll('.button-filter').forEach(b => {
                const btnSemester = b.onclick.toString().match(/filterWordsBySemester\(['"]([^'"]+)['"]/)[1];
                if (wordSemesterFilter.has(btnSemester)) {
                    b.classList.add('active');
                } else {
                    b.classList.remove('active');
                }
            });
        }

        // ==================== å­¸æœŸçµ±è¨ˆåŠŸèƒ½ ====================
        
        function updateSemesterCounts() {
            // è¨ˆç®—å„å­¸æœŸçš„å­—è©æ•¸é‡
            const charCounts = { 'all': 0, '1ä¸Š': 0, '1ä¸‹': 0, '2ä¸Š': 0, '2ä¸‹': 0 };
            const wordCounts = { 'all': 0, '1ä¸Š': 0, '1ä¸‹': 0, '2ä¸Š': 0, '2ä¸‹': 0 };
            
            // çµ±è¨ˆå­—
            learnedCharacters.forEach((data, char) => {
                charCounts['all']++;
                if (data.source) {
                    const semester = data.source.split('-')[0];
                    if (charCounts[semester] !== undefined) {
                        charCounts[semester]++;
                    }
                }
            });
            
            // çµ±è¨ˆè©
            learnedWords.forEach((data, word) => {
                wordCounts['all']++;
                if (data.source) {
                    const semester = data.source.split('-')[0];
                    if (wordCounts[semester] !== undefined) {
                        wordCounts[semester]++;
                    }
                }
            });
            
            // æ›´æ–°å­—çš„çµ±è¨ˆé¡¯ç¤º
            Object.keys(charCounts).forEach(semester => {
                const el = document.getElementById(`semCharCount-${semester}`);
                if (el) {
                    el.textContent = charCounts[semester];
                }
            });
            
            // æ›´æ–°è©çš„çµ±è¨ˆé¡¯ç¤º
            Object.keys(wordCounts).forEach(semester => {
                const el = document.getElementById(`semWordCount-${semester}`);
                if (el) {
                    el.textContent = wordCounts[semester];
                }
            });
        }

        // ==================== èª²åˆ¥ç¯©é¸åŠŸèƒ½ ====================
        
        function updateLessonOptions() {
            // æ ¹æ“šç•¶å‰é¸ä¸­çš„å­¸æœŸï¼Œå‹•æ…‹ç”Ÿæˆèª²åˆ¥é¸é …
            const lessonsForChar = new Set();
            const lessonsForWord = new Set();
            
            // æ”¶é›†å­—çš„ä¾†æºï¼ˆä½¿ç”¨ charSemesterFilterï¼‰
            learnedCharacters.forEach((data, char) => {
                if (data.source) {
                    // å¦‚æœæœ‰é¸æ“‡ç‰¹å®šå­¸æœŸï¼Œåªé¡¯ç¤ºè©²å­¸æœŸçš„èª²åˆ¥
                    if (!charSemesterFilter.has('all')) {
                        for (let semester of charSemesterFilter) {
                            if (data.source.startsWith(semester)) {
                                lessonsForChar.add(data.source);
                                break;
                            }
                        }
                    } else {
                        lessonsForChar.add(data.source);
                    }
                }
            });
            
            // æ”¶é›†è©çš„ä¾†æºï¼ˆä½¿ç”¨ wordSemesterFilterï¼‰
            learnedWords.forEach((data, word) => {
                if (data.source) {
                    // å¦‚æœæœ‰é¸æ“‡ç‰¹å®šå­¸æœŸï¼Œåªé¡¯ç¤ºè©²å­¸æœŸçš„èª²åˆ¥
                    if (!wordSemesterFilter.has('all')) {
                        for (let semester of wordSemesterFilter) {
                            if (data.source.startsWith(semester)) {
                                lessonsForWord.add(data.source);
                                break;
                            }
                        }
                    } else {
                        lessonsForWord.add(data.source);
                    }
                }
            });
            
            // æ’åºèª²åˆ¥ï¼ˆå…ˆæŒ‰å­¸æœŸï¼Œå†æŒ‰èª²è™Ÿï¼‰
            const sortLessons = (lessons) => {
                return Array.from(lessons).sort((a, b) => {
                    const [semA, lesA] = a.split('-');
                    const [semB, lesB] = b.split('-');
                    if (semA !== semB) {
                        // å­¸æœŸæ’åºï¼š1ä¸Š < 1ä¸‹ < 2ä¸Š < 2ä¸‹
                        const orderA = parseInt(semA[0]) * 2 + (semA[1] === 'ä¸‹' ? 1 : 0);
                        const orderB = parseInt(semB[0]) * 2 + (semB[1] === 'ä¸‹' ? 1 : 0);
                        return orderA - orderB;
                    }
                    return parseInt(lesA) - parseInt(lesB);
                });
            };
            
            const sortedLessonsChar = sortLessons(lessonsForChar);
            const sortedLessonsWord = sortLessons(lessonsForWord);
            
            // æ›´æ–°å­—çš„ä¸‹æ‹‰é¸å–®
            const lessonSelect = document.getElementById('lessonSelect');
            const currentCharValue = lessonSelect.value;
            lessonSelect.innerHTML = '<option value="all">å…¨éƒ¨èª²åˆ¥</option>';
            let hasCurrentValue = false;
            sortedLessonsChar.forEach(lesson => {
                const [sem, les] = lesson.split('-');
                const option = document.createElement('option');
                option.value = lesson;
                option.textContent = `${sem}ç¬¬${les}èª²`;
                lessonSelect.appendChild(option);
                if (lesson === currentCharValue) {
                    hasCurrentValue = true;
                }
            });
            // å¦‚æœç•¶å‰é¸æ“‡çš„èª²åˆ¥ä¸åœ¨æ–°åˆ—è¡¨ä¸­ï¼Œé‡ç½®ç‚ºå…¨éƒ¨
            if (!hasCurrentValue && currentCharValue !== 'all') {
                lessonSelect.value = 'all';
                charLessonFilter = 'all';
            } else {
                lessonSelect.value = currentCharValue;
            }
            
            // æ›´æ–°è©çš„ä¸‹æ‹‰é¸å–®
            const lessonSelectWord = document.getElementById('lessonSelectWord');
            const currentWordValue = lessonSelectWord.value;
            lessonSelectWord.innerHTML = '<option value="all">å…¨éƒ¨èª²åˆ¥</option>';
            let hasCurrentWordValue = false;
            sortedLessonsWord.forEach(lesson => {
                const [sem, les] = lesson.split('-');
                const option = document.createElement('option');
                option.value = lesson;
                option.textContent = `${sem}ç¬¬${les}èª²`;
                lessonSelectWord.appendChild(option);
                if (lesson === currentWordValue) {
                    hasCurrentWordValue = true;
                }
            });
            // å¦‚æœç•¶å‰é¸æ“‡çš„èª²åˆ¥ä¸åœ¨æ–°åˆ—è¡¨ä¸­ï¼Œé‡ç½®ç‚ºå…¨éƒ¨
            if (!hasCurrentWordValue && currentWordValue !== 'all') {
                lessonSelectWord.value = 'all';
                wordLessonFilter = 'all';
            } else {
                lessonSelectWord.value = currentWordValue;
            }
        }
        
        function applyLessonFilter(type) {
            if (type === 'char') {
                const select = document.getElementById('lessonSelect');
                charLessonFilter = select.value;
                updateCharsDisplay();
            } else {
                const select = document.getElementById('lessonSelectWord');
                wordLessonFilter = select.value;
                updateWordsDisplay();
            }
        }
        
        function clearLessonFilter(type) {
            if (type === 'char') {
                charLessonFilter = 'all';
                document.getElementById('lessonSelect').value = 'all';
                updateCharsDisplay();
            } else {
                wordLessonFilter = 'all';
                document.getElementById('lessonSelectWord').value = 'all';
                updateWordsDisplay();
            }
        }

        function matchesFilter(data, filterSet) {
            // å¦‚æœé¸æ“‡äº†ã€Œå…¨éƒ¨ã€ï¼Œé¡¯ç¤ºæ‰€æœ‰
            if (filterSet.has('all')) return true;
            
            // æª¢æŸ¥æ˜¯å¦åŒ¹é…ä»»ä¸€é¸æ“‡çš„ Level
            for (let level of filterSet) {
                if (data.level === level) return true;
            }
            
            return false;
        }

        // ==================== UI æ›´æ–° ====================

        function updateUI() {
            updateCharsDisplay();
            updateWordsDisplay();
            updateStats();
        }

        function updateCharsDisplay() {
            const chars = Array.from(learnedCharacters.entries());
            const container = document.getElementById('learnedChars');
            
            if (chars.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“š</div>
                        <p>é‚„æ²’æœ‰è¨˜éŒ„ï¼Œé–‹å§‹æ·»åŠ å§ï¼</p>
                    </div>
                `;
            } else {
                // å…ˆä¾ Level ç¯©é¸
                let filtered = chars.filter(([char, data]) => matchesFilter(data, charFilter));
                
                // å†ä¾å­¸æœŸç¯©é¸
                if (!charSemesterFilter.has('all')) {
                    filtered = filtered.filter(([char, data]) => {
                        if (!data.source) return false;
                        // æª¢æŸ¥æ˜¯å¦åŒ¹é…ä»»ä¸€é¸ä¸­çš„å­¸æœŸ
                        for (let semester of charSemesterFilter) {
                            if (data.source.startsWith(semester)) {
                                return true;
                            }
                        }
                        return false;
                    });
                }
                
                // å†ä¾èª²åˆ¥ç¯©é¸
                if (charLessonFilter !== 'all') {
                    filtered = filtered.filter(([char, data]) => {
                        return data.source === charLessonFilter;
                    });
                }
                
                if (filtered.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ”</div>
                            <p>é€™å€‹ç¯©é¸æ¢ä»¶æ²’æœ‰å­—</p>
                        </div>
                    `;
                    return;
                }
                
                const sorted = filtered.sort((a, b) => {
                    const levelDiff = a[1].level - b[1].level;
                    if (levelDiff !== 0) return levelDiff;
                    return a[0].localeCompare(b[0]);
                });
                
                container.innerHTML = sorted.map(([char, data]) => {
                    const mastered = data.level >= 3;
                    const masteryClass = mastered ? 'mastered' : '';
                    const indicator = data.level > 0 ? `<div class="mastery-indicator">${data.level}</div>` : '';
                    
                    return `
                        <div class="char-badge ${masteryClass}">
                            ${indicator}
                            <span class="char-text" data-char="${char}">${char}</span>
                        </div>
                    `;
                }).join('');
                
                container.querySelectorAll('.char-text').forEach(span => {
                    span.addEventListener('click', function(e) {
                        e.stopPropagation();
                        showEnlarged(this.getAttribute('data-char'));
                    });
                });
            }
        }

        function updateWordsDisplay() {
            const words = Array.from(learnedWords.entries());
            const container = document.getElementById('wordGrid');
            
            if (words.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸŒŸ</div>
                        <p>è¼¸å…¥è©å½™é–‹å§‹è¨˜éŒ„</p>
                    </div>
                `;
            } else {
                // å…ˆä¾ Level ç¯©é¸
                let filtered = words.filter(([word, data]) => matchesFilter(data, wordFilter));
                
                // å†ä¾å­¸æœŸç¯©é¸
                if (!wordSemesterFilter.has('all')) {
                    filtered = filtered.filter(([word, data]) => {
                        if (!data.source) return false;
                        // æª¢æŸ¥æ˜¯å¦åŒ¹é…ä»»ä¸€é¸ä¸­çš„å­¸æœŸ
                        for (let semester of wordSemesterFilter) {
                            if (data.source.startsWith(semester)) {
                                return true;
                            }
                        }
                        return false;
                    });
                }
                
                // å†ä¾èª²åˆ¥ç¯©é¸
                if (wordLessonFilter !== 'all') {
                    filtered = filtered.filter(([word, data]) => {
                        return data.source === wordLessonFilter;
                    });
                }
                
                if (filtered.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ”</div>
                            <p>é€™å€‹ç¯©é¸æ¢ä»¶æ²’æœ‰è©</p>
                        </div>
                    `;
                    return;
                }
                
                const sorted = filtered.sort((a, b) => {
                    const levelDiff = a[1].level - b[1].level;
                    if (levelDiff !== 0) return levelDiff;
                    return a[0].localeCompare(b[0]);
                });
                
                container.innerHTML = sorted.map(([word, data], index) => {
                    const mastered = data.level >= 3;
                    const masteryClass = mastered ? 'mastered' : '';
                    const indicator = data.level > 0 ? `<div class="mastery-indicator">${data.level}</div>` : '';
                    
                    return `
                        <div class="word-card ${masteryClass}" style="animation-delay: ${index * 0.05}s">
                            ${indicator}
                            <span class="word-chinese" data-word="${word}">${word}</span>
                        </div>
                    `;
                }).join('');
                
                container.querySelectorAll('.word-chinese').forEach(span => {
                    span.addEventListener('click', function(e) {
                        e.stopPropagation();
                        showEnlarged(this.getAttribute('data-word'));
                    });
                });
            }
        }

        function updateStats() {
            const totalChars = learnedCharacters.size;
            const reviewChars = Array.from(learnedCharacters.values())
                .filter(data => needsReview(data)).length;
            const masteredChars = Array.from(learnedCharacters.values())
                .filter(data => data.level >= 3).length;
            
            document.getElementById('totalChars').textContent = totalChars;
            document.getElementById('reviewChars').textContent = reviewChars;
            document.getElementById('masteredChars').textContent = masteredChars;
            
            const totalWords = learnedWords.size;
            const reviewWords = Array.from(learnedWords.values())
                .filter(data => needsReview(data)).length;
            const masteredWords = Array.from(learnedWords.values())
                .filter(data => data.level >= 3).length;
            
            document.getElementById('totalWords').textContent = totalWords;
            document.getElementById('reviewWords').textContent = reviewWords;
            document.getElementById('masteredWords').textContent = masteredWords;
        }

        // ==================== å·¥å…·å‡½å¼ ====================

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, var(--success) 0%, var(--primary) 100%);
                color: white;
                padding: 15px 25px;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
                z-index: 2000;
                animation: slideInRight 0.3s ease;
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // ==================== éµç›¤å¿«æ·éµ ====================

        document.getElementById('charInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addCharacter();
            }
        });

        document.getElementById('wordInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addWord();
            }
        });

        document.getElementById('bulkInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) {
                addBulkCharacters();
            }
        });

        document.addEventListener('keydown', (e) => {
            const reviewModal = document.getElementById('reviewModal');
            const enlargeModal = document.getElementById('enlargeModal');
            
            if (reviewModal.classList.contains('active')) {
                if (e.key === 'ArrowRight' || e.key === 'o' || e.key === 'O') {
                    e.preventDefault();
                    markCorrect();
                } else if (e.key === 'ArrowLeft' || e.key === 'x' || e.key === 'X') {
                    e.preventDefault();
                    markIncorrect();
                } else if (e.key === 'Escape') {
                    endReview();
                }
            } else if (enlargeModal.classList.contains('active')) {
                if (e.key === 'Escape' || e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    closeEnlarge();
                }
            }
        });

        // ==================== åˆå§‹åŒ– ====================

        // åˆå§‹åŒ–å­¸æœŸç¯©é¸å’Œèª²åˆ¥ç¯©é¸é¡¯ç¤ºï¼ˆåªæœ‰å“¥å“¥æ‰é¡¯ç¤ºï¼‰
        const semesterFilterChar = document.getElementById('semesterFilterChar');
        const semesterFilterWord = document.getElementById('semesterFilterWord');
        const lessonFilterChar = document.getElementById('lessonFilterChar');
        const lessonFilterWord = document.getElementById('lessonFilterWord');
        if (currentLearner === 'brother') {
            semesterFilterChar.style.display = 'block';
            semesterFilterWord.style.display = 'block';
            lessonFilterChar.style.display = 'block';
            lessonFilterWord.style.display = 'block';
        } else {
            semesterFilterChar.style.display = 'none';
            semesterFilterWord.style.display = 'none';
            lessonFilterChar.style.display = 'none';
            lessonFilterWord.style.display = 'none';
        }

        // ==================== æœ¬åœ°å„²å­˜ç³»çµ± ====================
        // ç´” localStorage ç‰ˆæœ¬ï¼šä¸éœ€è¦ç™»å…¥ï¼Œç›´æ¥ä½¿ç”¨
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥è³‡æ–™
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“± æœ¬åœ°ç‰ˆæœ¬è¼‰å…¥ä¸­...');
            loadData();
            updateUI();
            console.log('âœ… è³‡æ–™è¼‰å…¥å®Œæˆ');
            console.log('å­—æ•¸:', learnedCharacters.size);
            console.log('è©æ•¸:', learnedWords.size);
        });
        
// ==================== ç›¸è¿‘å­—è¾¨è­˜åŠŸèƒ½ï¼ˆå¦¹å¦¹å°ˆå±¬ï¼‰====================
        
        // ç®¡ç†ç›¸è¿‘å­—
        function manageSimilarChars() {
            loadSimilarPairs();
            renderSimilarPairs();
            document.getElementById('manageSimilarModal').classList.add('active');
        }
        
        function closeSimilarManage() {
            document.getElementById('manageSimilarModal').classList.remove('active');
        }
        
        // æ–°å¢ç›¸è¿‘å­—çµ„
        function addSimilarPair() {
            const char1 = document.getElementById('similarChar1').value.trim();
            const char2 = document.getElementById('similarChar2').value.trim();
            
            if (!char1 || !char2) {
                alert('è«‹è¼¸å…¥å…©å€‹å­—');
                return;
            }
            
            if (char1 === char2) {
                alert('å…©å€‹å­—ä¸èƒ½ç›¸åŒ');
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨
            const exists = similarCharPairs.some(pair => 
                (pair.char1 === char1 && pair.char2 === char2) ||
                (pair.char1 === char2 && pair.char2 === char1)
            );
            
            if (exists) {
                alert('é€™çµ„ç›¸è¿‘å­—å·²ç¶“å­˜åœ¨');
                return;
            }
            
            similarCharPairs.push({char1, char2});
            saveSimilarPairs();
            renderSimilarPairs();
            
            // æ¸…ç©ºè¼¸å…¥
            document.getElementById('similarChar1').value = '';
            document.getElementById('similarChar2').value = '';
            
            showNotification(`âœ… å·²æ–°å¢ï¼š${char1} vs ${char2}`);
        }
        
        // åˆªé™¤ç›¸è¿‘å­—çµ„
        function deleteSimilarPair(index) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™çµ„ç›¸è¿‘å­—ï¼Ÿ')) return;
            
            const pair = similarCharPairs[index];
            similarCharPairs.splice(index, 1);
            saveSimilarPairs();
            renderSimilarPairs();
            
            showNotification(`âœ… å·²åˆªé™¤ï¼š${pair.char1} vs ${pair.char2}`);
        }
        
        // æ¸²æŸ“ç›¸è¿‘å­—åˆ—è¡¨
        function renderSimilarPairs() {
            const container = document.getElementById('pairsContainer');
            
            if (similarCharPairs.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">å°šæœªå»ºç«‹ä»»ä½•ç›¸è¿‘å­—çµ„</p>';
                return;
            }
            
            let html = '';
            similarCharPairs.forEach((pair, index) => {
                html += `
                    <div style="display: flex; align-items: center; justify-content: space-between; background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="font-size: 2rem; font-weight: bold;">${pair.char1}</span>
                            <span style="color: #999;">vs</span>
                            <span style="font-size: 2rem; font-weight: bold;">${pair.char2}</span>
                        </div>
                        <button onclick="deleteSimilarPair(${index})" style="padding: 8px 15px; background: #ff4444; color: white; border: none; border-radius: 6px; cursor: pointer;">åˆªé™¤</button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // é–‹å§‹ç›¸è¿‘å­—æ¸¬é©—
        function startSimilarCharQuiz() {
            if (similarCharPairs.length === 0) {
                alert('é‚„æ²’æœ‰å»ºç«‹ä»»ä½•ç›¸è¿‘å­—çµ„ï¼\nè«‹å…ˆé»æ“Šã€Œç®¡ç†ç›¸è¿‘å­—ã€æ–°å¢ã€‚');
                return;
            }
            
            // ç‚ºæ¯çµ„ç›¸è¿‘å­—å‰µå»ºå…©å€‹é¡Œç›®ï¼ˆæ­£åå„ä¸€é¡Œï¼‰
            quizList = [];
            similarCharPairs.forEach(pair => {
                // é¡Œç›®1: å• char1ï¼Œé¸é …æ˜¯ char1 å’Œ char2
                quizList.push({
                    target: pair.char1,
                    options: [pair.char1, pair.char2],
                    correctAnswer: 0
                });
                // é¡Œç›®2: å• char2ï¼Œé¸é …æ˜¯ char1 å’Œ char2
                quizList.push({
                    target: pair.char2,
                    options: [pair.char1, pair.char2],
                    correctAnswer: 0
                });
            });
            
            // éš¨æ©Ÿæ’åº
            quizList = shuffleArray(quizList);
            quizIndex = 0;
            
            showSimilarQuiz();
            document.getElementById('similarQuizModal').classList.add('active');
        }
        
        // é¡¯ç¤ºæ¸¬é©—é¡Œç›®
        function showSimilarQuiz() {
            if (quizIndex >= quizList.length) {
                document.getElementById('quizProgress').textContent = 'ğŸ‰ æ¸¬é©—å®Œæˆï¼';
                document.getElementById('quizTarget').textContent = 'å¤ªæ£’äº†ï¼';
                document.getElementById('quizQuestion').textContent = 'å…¨éƒ¨å®Œæˆï¼Œç¹¼çºŒåŠ æ²¹ï¼';
                document.getElementById('quizOption1').style.display = 'none';
                document.getElementById('quizOption2').style.display = 'none';
                return;
            }
            
            const quiz = quizList[quizIndex];
            const total = quizList.length;
            
            // éš¨æ©Ÿæ±ºå®šé¸é …é †åº
            const randomOrder = Math.random() < 0.5;
            currentQuizAnswer = randomOrder ? 1 : 0;
            
            const option1 = randomOrder ? quiz.options[1] : quiz.options[0];
            const option2 = randomOrder ? quiz.options[0] : quiz.options[1];
            
            document.getElementById('quizProgress').textContent = `ç¬¬ ${quizIndex + 1} / ${total} é¡Œ`;
            document.getElementById('quizTarget').textContent = quiz.target;
            document.getElementById('quizQuestion').textContent = `é¸å‡ºæ­£ç¢ºçš„å­—ï¼š`;
            
            document.getElementById('quizOption1').textContent = option1;
            document.getElementById('quizOption2').textContent = option2;
            document.getElementById('quizOption1').style.display = 'block';
            document.getElementById('quizOption2').style.display = 'block';
            document.getElementById('quizResult').style.display = 'none';
        }
        
        // é¸æ“‡ç­”æ¡ˆ
        function selectQuizAnswer(selected) {
            const quiz = quizList[quizIndex];
            const resultDiv = document.getElementById('quizResult');
            
            // åˆ¤æ–·æ˜¯å¦æ­£ç¢º
            const isCorrect = (selected === 0 && currentQuizAnswer === 0) || 
                             (selected === 1 && currentQuizAnswer === 1);
            
            if (isCorrect) {
                resultDiv.textContent = 'âœ… ç­”å°äº†ï¼';
                resultDiv.style.background = '#d4edda';
                resultDiv.style.color = '#155724';
            } else {
                resultDiv.textContent = `âŒ ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${quiz.target}`;
                resultDiv.style.background = '#f8d7da';
                resultDiv.style.color = '#721c24';
            }
            
            resultDiv.style.display = 'block';
            
            // 1ç§’å¾Œè‡ªå‹•é€²å…¥ä¸‹ä¸€é¡Œ
            setTimeout(() => {
                quizIndex++;
                showSimilarQuiz();
            }, 1500);
        }
        
        // çµæŸæ¸¬é©—
        function endSimilarQuiz() {
            document.getElementById('similarQuizModal').classList.remove('active');
        }
        
        // å„²å­˜ç›¸è¿‘å­—åˆ° localStorage å’Œ Firebase
        function saveSimilarPairs() {
            localStorage.setItem('sister_similarPairs', JSON.stringify(similarCharPairs));
            // æœ¬åœ°ç‰ˆæœ¬ä¸éœ€è¦ Firebase åŒæ­¥
        }
        
        // è¼‰å…¥ç›¸è¿‘å­—
        function loadSimilarPairs() {
            const saved = localStorage.getItem('sister_similarPairs');
            if (saved) {
                try {
                    similarCharPairs = JSON.parse(saved);
                } catch (e) {
                    similarCharPairs = [];
                }
            }
        }
        
        // æœ¬åœ°ç‰ˆæœ¬ä¸éœ€è¦ Firebase åŒæ­¥
                }, { merge: true });
            } catch (error) {
                console.error('å„²å­˜ç›¸è¿‘å­—å¤±æ•—:', error);
            }
        }
        
        }
            } catch (error) {
                console.error('è¼‰å…¥ç›¸è¿‘å­—å¤±æ•—:', error);
            }
        }
        

        // ==================== é é¢åˆå§‹åŒ– ====================
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œè‡ªå‹•åŸ·è¡Œ
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“± ä¸­æ–‡å­¸ç¿’è¨˜éŒ„å™¨ - æœ¬åœ°ç‰ˆ');
            console.log('âœ“ ä¸éœ€è¦ç™»å…¥ï¼Œè³‡æ–™å­˜åœ¨ç€è¦½å™¨æœ¬åœ°');
            
            // è¼‰å…¥è³‡æ–™
            loadData();
            
            // æ›´æ–° UI
            updateUI();
            
            // åˆå§‹åŒ–ç¯©é¸å™¨
            initSemesterFilters();
            
            console.log('âœ… è¼‰å…¥å®Œæˆ');
            console.log('  ç•¶å‰å­¸ç¿’è€…:', currentLearner === 'brother' ? 'å“¥å“¥' : 'å¦¹å¦¹');
            console.log('  å­—æ•¸:', learnedCharacters.size);
            console.log('  è©æ•¸:', learnedWords.size);
        });
    </script>
    </div> <!-- é—œé–‰ appContent -->
</body>
</html>
